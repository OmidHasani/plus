<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ù„ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§ÛŒØ¯Ù‡</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #f4f6f9;
      max-width: 950px;
      margin: 40px auto;
      padding: 20px;
      color: #333;
      line-height: 1.9;
    }
    h1 {
      text-align: center;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
      margin-bottom: 30px;
      color: #2c3e50;
    }
    .section {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    .section h2 {
      color: #0057a3;
      font-size: 20px;
      margin-bottom: 15px;
    }
    .section h3 {
      color: #1f3b73;
      font-size: 18px;
      margin: 20px 0 10px;
    }
    .analysis-text {
      font-size: 16px;
      color: #444;
      margin-bottom: 15px;
    }
    .impact-list {
      list-style-type: disc;
      padding-right: 20px;
      font-size: 16px;
      color: #333;
    }
    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      margin: 10px 5px 0 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { 
      background: #217dbb; 
    }
    .btn-red {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      margin: 10px 5px 0 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn-red:hover { 
      background: #c0392b; 
    }
    .btn-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .popup-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow: hidden;
      animation: slideIn 0.3s ease;
    }

    .popup-header {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .popup-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }

    .popup-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s ease;
    }

    .popup-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .popup-body {
      padding: 25px;
      text-align: center;
    }

    .popup-body p {
      margin: 0;
      font-size: 16px;
      line-height: 1.6;
      color: #333;
    }

    .popup-footer {
      padding: 20px;
      text-align: center;
      border-top: 1px solid #eee;
    }

    .popup-btn {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      font-family: 'Vazirmatn', sans-serif;
    }

    .popup-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Revenue Models Styles - Clean & Simple */
    .revenue-models-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
    }

    .revenue-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .revenue-content:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    }

    .revenue-text {
      color: rgba(255, 255, 255, 0.95);
      line-height: 1.8;
      font-size: 1em;
      text-align: right;
      direction: rtl;
    }

    .revenue-text strong {
      color: #fff;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .revenue-text br {
      margin-bottom: 8px;
    }

    .revenue-details {
      color: #555;
      font-size: 15px;
      line-height: 1.6;
    }

    .revenue-details strong {
      color: #2c3e50;
      font-weight: 600;
    }

    .loading-revenue {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
      font-size: 16px;
    }

    .revenue-error {
      background: #fdf2f2;
      border: 1px solid #fecaca;
      color: #e74c3c;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .brand-section {
      margin-bottom: 30px;
    }

    .brand-section h3 {
      font-weight: 700;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
  
  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø²ÛŒØ¨Ø§ -->
  <div id="popup-overlay" class="popup-overlay" style="display: none;">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="popup-title">Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡</h3>
        <button class="popup-close" onclick="closePopup()">&times;</button>
      </div>
      <div class="popup-body">
        <p id="popup-message">Ù¾ÛŒØ§Ù… Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
      </div>
      <div class="popup-footer">
        <button class="popup-btn" onclick="closePopup()">Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…</button>
      </div>
    </div>
  </div>
</head>
<body>

<h1 id="pageTitle">ØªØ­Ù„ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§ÛŒØ¯Ù‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ</h1>

<!-- Idea Information Section -->
<div class="section" id="ideaInfoSection" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border: 2px solid #dee2e6;">
  <h2 style="color: #495057; margin-bottom: 15px;">ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÛŒØ¯Ù‡</h2>
  <div id="ideaInfo" style="font-size: 16px; line-height: 1.6;">
    <div style="margin-bottom: 10px;"><strong>Ø¹Ù†ÙˆØ§Ù† Ø§ÛŒØ¯Ù‡:</strong> <span id="ideaTitleDisplay">-</span></div>
    <div style="margin-bottom: 10px;"><strong>Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±:</strong> <span id="partnerNameDisplay">-</span></div>
    <div><strong>ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> <span id="ideaDescriptionDisplay">-</span></div>
  </div>
</div>

<div class="section">
  <h2>Ú†Ø±Ø§ Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ø² Ø²Ø§ÙˆÛŒÙ‡ CSRØŒ PR Ùˆ Branding Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø±Ø¯ØŸ</h2>
  <div id="analysis" class="analysis-text">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª ØªØ­Ù„ÛŒÙ„...</div>
</div>

<!-- Revenue Models Section -->
<div class="section" id="revenueSection" style="display: none;">
  <h2>ğŸ’° Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</h2>
  
  <!-- My Brand Revenue Models -->
  <div class="brand-section">
    <h3 id="myBrandTitle" style="color: #2c3e50; font-size: 20px; margin: 20px 0 15px 0; padding: 10px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-radius: 8px; text-align: center;"></h3>
    <div id="myBrandRevenueModels" class="revenue-models-container">
      <!-- My brand revenue models will be displayed here -->
    </div>
  </div>
  
  <!-- Target Brand Revenue Models -->
  <div class="brand-section">
    <h3 id="targetBrandTitle" style="color: #2c3e50; font-size: 20px; margin: 20px 0 15px 0; padding: 10px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border-radius: 8px; text-align: center;"></h3>
    <div id="targetBrandRevenueModels" class="revenue-models-container">
      <!-- Target brand revenue models will be displayed here -->
    </div>
  </div>
</div>


<div class="btn-container">
  <button class="btn" id="btnSample">ğŸ“Œ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡</button>
  <button class="btn" id="btnBenefits">ğŸ¤ Ù…Ø²Ø§ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø·Ø±ÙÛŒÙ†</button>
  <button class="btn" id="btnRevenue">ğŸ’° Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ</button>
  <button class="btn" id="btnEconomy">ğŸ“Š ØªÙˆØ¬ÛŒÙ‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ</button>
  <button class="btn" id="btnStrategy">ğŸ“ˆ ÛŒÚ© Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù…</button>
  <button class="btn" id="btnCooperation" style="background: #27ae60; color: white;">ğŸ¤ Ù¾Ø°ÛŒØ±ÙØªÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ</button>
  
  <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ -->
  <div id="cooperationButtons" style="margin-top: 15px; text-align: center;">
    <!-- Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ (Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ù…) -->
    <button id="sendCooperationBtn" onclick="sendCooperationRequest()" class="btn" style="background: #3498db; color: white; display: none;">
      ğŸ¤ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ
    </button>
    
    <!-- Ø¯Ú©Ù…Ù‡ Ù¾Ø°ÛŒØ±ÙØªÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ (Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ) -->
    <button id="acceptCooperationBtn" onclick="acceptCooperation()" class="btn" style="background: #e74c3c; color: white; display: none;">
      âœ… Ù¾Ø°ÛŒØ±ÙØªÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ
    </button>
    
    <!-- Ø¯Ú©Ù…Ù‡ Ù‚ÙÙ„ Ø´Ø¯Ù‡ -->
    <button id="lockedBtn" class="btn" style="background: #95a5a6; color: white; display: none;" disabled>
      ğŸ”’ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡
    </button>
  </div>
  <button class="btn-red" id="btnBack">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
</div>

<script>
async function fetchMyBrand() {
  const res = await fetch("/api/my-brand", { credentials: "include" });
  if (!res.ok) throw new Error("Ø¨Ø±Ù†Ø¯ Ø´Ù…Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
  return await res.json();
}

function getTargetBrandId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("target");
}

async function callOpenAI(prompt, myBrandId, targetBrandId) {
  const res = await fetch("/api/generate-ideas", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ 
      prompt, 
      myBrandId, 
      targetBrandId 
    })
  });

  if (!res.ok) {
    const err = await res.json();
    throw new Error(err.error?.message || "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ø³Ø® OpenAI");
  }

  const data = await res.json();
  console.log("Ø®Ø§Ù… API OpenAI:", JSON.stringify(data, null, 2));
  return data.choices[0].message.content;
}

function splitAnalysisAndImpacts(text) {
  const analysis = text.trim();
  return { analysis };
}

function showFallbackAnalysis(ideaPrompt) {
  const analysisDiv = document.getElementById("analysis");
  
  // ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ùˆ Ú©Ù„ÛŒ
  analysisDiv.innerHTML = `
    <div style="color: #2c3e50; background: #ecf0f1; padding: 15px; border-radius: 8px; border: 1px solid #bdc3c7;">
      <h4 style="margin: 0 0 10px 0;">ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ Ø§ÛŒØ¯Ù‡</h4>
      <p style="margin: 0;">Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø§Ø² Ø²ÙˆØ§ÛŒØ§ÛŒ Ù…Ø®ØªÙ„Ù (CSRØŒ PRØŒ Branding) Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³Øª Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ùˆ Ø¨Ø±Ù†Ø¯ Ù…Ø²Ø§ÛŒØ§ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ÛŒ Ø¨Ù‡ Ù‡Ù…Ø±Ø§Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.</p>
    </div>
  `;
}

async function loadIdeaAnalysis() {
  const ideaPrompt = sessionStorage.getItem("ideaPrompt");
  const analysisDiv = document.getElementById("analysis");

  // Ø§Ú¯Ø± Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± sessionStorage Ù†ÛŒØ³ØªØŒ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
  if (!ideaPrompt) {
    analysisDiv.innerHTML = `
      <div style="color: #f39c12; background: #fef9e7; padding: 15px; border-radius: 8px; border: 1px solid #f4d03f;">
        <h4 style="margin: 0 0 10px 0;">âš ï¸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÛŒØ¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯</h4>
        <p style="margin: 0;">Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ø² ØµÙØ­Ù‡ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ ÛŒÚ© Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
        <button onclick="window.history.back()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
          ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
      </div>
    `;
    return;
  }

  try {
    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§
    const myBrand = await fetchMyBrand();
    console.log("ğŸ” Debug - myBrand:", myBrand);
    
    let targetBrandId = sessionStorage.getItem("targetBrandId");
    console.log("ğŸ” Debug - targetBrandId from sessionStorage:", targetBrandId);
    
    if (!targetBrandId) {
      throw new Error("Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù ÛŒØ§ÙØª Ù†Ø´Ø¯.");
    }

    const newPrompt = `
Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ±:
${ideaPrompt}

ÛŒÚ© ØªØ­Ù„ÛŒÙ„ ØºÙ†ÛŒ Ùˆ Ù¾Ø±Ù…Ø­ØªÙˆØ§ (Û´â€“Ûµ Ø®Ø·) Ø¨Ù†ÙˆÛŒØ³ Ú©Ù‡ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡Ø¯ Ú†Ø±Ø§ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø²Ø§ÙˆÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ (CSR)ØŒ Ø±ÙˆØ§Ø¨Ø· Ø¹Ù…ÙˆÙ…ÛŒ (PR) Ùˆ Ø¨Ø±Ù†Ø¯Ø³Ø§Ø²ÛŒ (Branding) Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯. Ø§ÛŒÙ† ØªØ­Ù„ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø¹Ù…ÛŒÙ‚ Ùˆ Ù…ØªÙ‚Ø§Ø¹Ø¯Ú©Ù†Ù†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ Ùˆ Ù…Ø²Ø§ÛŒØ§ÛŒ Ø§ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ø§Ø² Ù‡Ø± Ø³Ù‡ Ø²Ø§ÙˆÛŒÙ‡ Ø¨Ù‡ Ø·ÙˆØ± Ø¬Ø§Ù…Ø¹ Ù¾ÙˆØ´Ø´ Ø¯Ù‡Ø¯.

Ù‡ÛŒÚ† Ù…Ù‚Ø¯Ù…Ù‡ ÛŒØ§ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ù†ÙˆÛŒØ³. ÙÙ‚Ø· Ù‡Ù…ÛŒÙ† ØªØ­Ù„ÛŒÙ„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³.
`;

    analysisDiv.textContent = "â³ Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...";
    const response = await callOpenAI(newPrompt, myBrand._id, targetBrandId);
    const { analysis } = splitAnalysisAndImpacts(response);

    analysisDiv.innerHTML = analysis.replace(/\n/g, "<br>");
  } catch (err) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡:", err);
    
    // Ø§Ú¯Ø± Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø§Ø³ØªØŒ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    if (err.message.includes("Ø³Ø±ÙˆÛŒØ³ ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ù…ÙˆÙ‚ØªØ§Ù‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª") || err.message.includes("Ø®Ø·Ø§ Ø¯Ø± API")) {
      // Ù†Ù…Ø§ÛŒØ´ ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§
      showFallbackAnalysis(ideaPrompt);
    } else {
      analysisDiv.innerHTML = `
        <div style="color: #e74c3c; background: #fdf2f2; padding: 15px; border-radius: 8px; border: 1px solid #fecaca;">
          <h4 style="margin: 0 0 10px 0;">âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡</h4>
          <p style="margin: 0;">${err.message}</p>
          <button onclick="loadIdeaAnalysis()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
            ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
          </button>
        </div>
      `;
    }
  }
}

// ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§Ù¾â€ŒØ¢Ù¾
function showPopup(title, message) {
  document.getElementById('popup-title').textContent = title;
  document.getElementById('popup-message').textContent = message;
  document.getElementById('popup-overlay').style.display = 'flex';
}

function closePopup() {
  document.getElementById('popup-overlay').style.display = 'none';
}

document.getElementById("btnEconomy").addEventListener("click", () => {
  showPopup("ğŸ“Š ØªÙˆØ¬ÛŒÙ‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ØªÙˆØ¬ÛŒÙ‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ú©Ø§Ù…Ù„ Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnSample").addEventListener("click", () => {
  showPopup("ğŸ“Œ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ù…Ø´Ø§Ø¨Ù‡ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.");
});

document.getElementById("btnBenefits").addEventListener("click", () => {
  showPopup("ğŸ¤ Ù…Ø²Ø§ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø·Ø±ÙÛŒÙ†", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ø²Ø§ÛŒØ§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnRevenue").addEventListener("click", async () => {
  await generateRevenueModels();
});

document.getElementById("btnStrategy").addEventListener("click", () => {
  showPopup("ğŸ“ˆ ÛŒÚ© Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù…", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ùˆ Ø¬Ø²Ø¦ÛŒ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnBack").addEventListener("click", () => {
  window.location.href = "dashboard.html";
});

document.getElementById("btnCooperation").addEventListener("click", async () => {
  await acceptCooperationRequest();
});

// Ù¾Ø°ÛŒØ±ÙØªÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ
async function acceptCooperationRequest() {
  try {
    const ideaTitle = sessionStorage.getItem("ideaTitle") || "Ø§ÛŒØ¯Ù‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ";
    const partnerName = sessionStorage.getItem("partnerName") || "Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±";
    const receivedRequestId = sessionStorage.getItem("receivedRequestId");
    
    if (!receivedRequestId) {
      showPopup("Ø®Ø·Ø§", "Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯");
      return;
    }

    const response = await fetch(`/api/cooperation-requests/${receivedRequestId}/accept`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      credentials: 'include'
    });

    if (response.ok) {
      // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
      const button = document.getElementById('btnCooperation');
      button.disabled = true;
      button.innerHTML = '<i class="fas fa-check"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯';
      button.style.background = '#28a745';
      
      showPopup("Ù…ÙˆÙÙ‚ÛŒØª", `Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ø§ÛŒ ${partnerName} Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯!`);
    } else {
      const error = await response.json();
      showPopup("Ø®Ø·Ø§", error.error || "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ");
    }
  } catch (error) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ:", error);
    showPopup("Ø®Ø·Ø§", "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ");
  }
}

// ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ
async function generateRevenueModels() {
  const revenueSection = document.getElementById("revenueSection");
  const myBrandRevenueModels = document.getElementById("myBrandRevenueModels");
  const targetBrandRevenueModels = document.getElementById("targetBrandRevenueModels");
  const btnRevenue = document.getElementById("btnRevenue");
  
  // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ
  revenueSection.style.display = "block";
  
  // Ù†Ù…Ø§ÛŒØ´ Ø­Ø§Ù„Øª Ù„ÙˆØ¯ÛŒÙ†Ú¯
  myBrandRevenueModels.innerHTML = `
    <div class="loading-revenue">
      <div style="font-size: 24px; margin-bottom: 10px;">â³</div>
      Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡...
    </div>
  `;
  
  targetBrandRevenueModels.innerHTML = `
    <div class="loading-revenue">
      <div style="font-size: 24px; margin-bottom: 10px;">â³</div>
      Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡...
    </div>
  `;
  
  // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
  btnRevenue.disabled = true;
  btnRevenue.textContent = "â³ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...";
  
  try {
    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§
    const myBrand = await fetchMyBrand();
    const targetBrandId = sessionStorage.getItem("targetBrandId");
    const ideaDescription = sessionStorage.getItem("ideaDescription") || sessionStorage.getItem("ideaPrompt");
    
    if (!ideaDescription) {
      throw new Error("Ø´Ø±Ø­ Ø§ÛŒØ¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯");
    }
    
    if (!targetBrandId) {
      throw new Error("Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù ÛŒØ§ÙØª Ù†Ø´Ø¯");
    }

    // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ
    const response = await fetch("/api/generate-revenue-models", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ 
        ideaDescription, 
        myBrandId: myBrand._id, 
        targetBrandId 
      })
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.error || "Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ");
    }

    const data = await response.json();
    const revenueContent = data.choices[0].message.content;
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ
    await displayRevenueModels(revenueContent);
    
  } catch (error) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ:", error);
    
    const errorHtml = `
      <div class="revenue-error">
        <h4 style="margin: 0 0 10px 0;">âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ</h4>
        <p style="margin: 0;">${error.message}</p>
        <button onclick="generateRevenueModels()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
          ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
        </button>
      </div>
    `;
    
    myBrandRevenueModels.innerHTML = errorHtml;
    targetBrandRevenueModels.innerHTML = errorHtml;
  } finally {
    // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø¯Ú©Ù…Ù‡
    btnRevenue.disabled = false;
    btnRevenue.textContent = "ğŸ’° Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ";
  }
}

// Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ
async function displayRevenueModels(content) {
  // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§
  const myBrand = await fetchMyBrand();
  const targetBrandId = sessionStorage.getItem("targetBrandId");
  
  // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù
  let targetBrand = null;
  if (targetBrandId) {
    try {
      const response = await fetch(`/api/brand/${targetBrandId}`, { credentials: 'include' });
      if (response.ok) {
        targetBrand = await response.json();
      }
    } catch (error) {
      console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù:", error);
    }
  }
  
  // ØªÙ†Ø¸ÛŒÙ… Ø¹Ù†Ø§ÙˆÛŒÙ† Ø¨Ø±Ù†Ø¯Ù‡Ø§
  document.getElementById("myBrandTitle").textContent = `Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ${myBrand.name}`;
  document.getElementById("targetBrandTitle").textContent = `Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ${targetBrand ? targetBrand.name : 'Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±'}`;
  
  // Ú†Ø§Ù¾ Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø§Ù… Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
  console.log("ğŸ” Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² API:");
  console.log("==================================================");
  console.log(content);
  console.log("==================================================");
  
  // ØªØ³Øª Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
  if (content.includes('**Ø¨Ø±Ø§ÛŒ')) {
    console.log("âœ… Ø³Ø§Ø®ØªØ§Ø± **Ø¨Ø±Ø§ÛŒ** Ù¾ÛŒØ¯Ø§ Ø´Ø¯");
  } else {
    console.log("âŒ Ø³Ø§Ø®ØªØ§Ø± **Ø¨Ø±Ø§ÛŒ** Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
  }
  
  if (content.match(/\d+\./)) {
    console.log("âœ… Ø³Ø§Ø®ØªØ§Ø± Ø´Ù…Ø§Ø±Ù‡â€ŒØ¯Ø§Ø± Ù¾ÛŒØ¯Ø§ Ø´Ø¯");
  } else {
    console.log("âŒ Ø³Ø§Ø®ØªØ§Ø± Ø´Ù…Ø§Ø±Ù‡â€ŒØ¯Ø§Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
  }
  
  // ØªÙ‚Ø³ÛŒÙ… Ù…Ø­ØªÙˆØ§ Ø¨Ù‡ Ø¯Ùˆ Ø¨Ø®Ø´: Ø¨Ø±Ù†Ø¯ Ù…Ù† Ùˆ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù
  console.log("ğŸ” Ù…Ø­ØªÙˆØ§ÛŒ Ú©Ø§Ù…Ù„ API:", content);
  console.log("ğŸ” Ø·ÙˆÙ„ Ù…Ø­ØªÙˆØ§:", content.length);
  
  // ØªÙ‚Ø³ÛŒÙ… Ø³Ø§Ø¯Ù‡ Ù…Ø­ØªÙˆØ§ Ø¨Ù‡ Ø¯Ùˆ Ø¨Ø®Ø´
  const midPoint = Math.floor(content.length / 2);
  const myBrandSection = content.substring(0, midPoint);
  const targetBrandSection = content.substring(midPoint);
  
  console.log("ğŸ” ØªÙ‚Ø³ÛŒÙ… Ø³Ø§Ø¯Ù‡ Ù…Ø­ØªÙˆØ§:");
  console.log("Ø¨Ø®Ø´ Ø§ÙˆÙ„ (Ø·ÙˆÙ„:", myBrandSection.length, "):", myBrandSection.substring(0, 100) + "...");
  console.log("Ø¨Ø®Ø´ Ø¯ÙˆÙ… (Ø·ÙˆÙ„:", targetBrandSection.length, "):", targetBrandSection.substring(0, 100) + "...");
  
  console.log("ğŸ” Ø¨Ø®Ø´ Ø¨Ø±Ù†Ø¯ Ù…Ù† (Ø·ÙˆÙ„:", myBrandSection.length, "):", myBrandSection.substring(0, 500) + "...");
  console.log("ğŸ” Ø¨Ø®Ø´ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù (Ø·ÙˆÙ„:", targetBrandSection.length, "):", targetBrandSection.substring(0, 500) + "...");
  
  // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø¯ Ù…Ù†
  displayBrandRevenueModels('myBrandRevenueModels', myBrandSection, myBrand.name);
  
  // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù
  displayBrandRevenueModels('targetBrandRevenueModels', targetBrandSection, targetBrand ? targetBrand.name : 'Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±');
}

// Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø¨Ø±Ù†Ø¯ Ø®Ø§Øµ
function displayBrandRevenueModels(containerId, content, brandName) {
  const container = document.getElementById(containerId);
  
  console.log(`ğŸ” Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ${brandName}:`);
  console.log("Ù…Ø­ØªÙˆØ§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ:", content.substring(0, 300) + "...");
  
  if (!content.trim()) {
    container.innerHTML = `
      <div class="revenue-error">
        <p>Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ${brandName} ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
      </div>
    `;
    return;
  }
  
  console.log(`ğŸ” Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ ${brandName}:`, content.substring(0, 200) + "...");
  
  // Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø¯Ù‡ Ù…Ø­ØªÙˆØ§ Ø¨Ø¯ÙˆÙ† Ù¾Ø§Ø±Ø³ÛŒÙ†Ú¯ Ù¾ÛŒÚ†ÛŒØ¯Ù‡
  const formattedContent = content
    .replace(/\n/g, '<br>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/- (.*?):/g, '<br><strong>$1:</strong> ')
    .replace(/^\s*-\s*/gm, '<br>â€¢ ');
  
  const html = `
    <div class="revenue-content">
      <div class="revenue-text">
        ${formattedContent}
      </div>
    </div>
  `;
  
  // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ù…Ø¯Ù„ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø§Ù… Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
  if (html === '') {
    console.log("ğŸ” Ù‡ÛŒÚ† Ù…Ø¯Ù„ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø§Ù…");
    const formattedContent = content
      .replace(/\n/g, '<br>')
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/- (.*?):/g, '<br><strong>$1:</strong> ')
      .replace(/^\s*-\s*/gm, '<br>â€¢ ');
    
    html = `
      <div class="revenue-content">
        <div class="revenue-text">
          ${formattedContent}
        </div>
      </div>
    `;
  }
  
  console.log(`ğŸ” HTML Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ${brandName}:`, html.substring(0, 200) + "...");
  container.innerHTML = html;
}

// Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú©Ø§Ø±ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨
async function checkCooperationStatus() {
  try {
    const ideaTitle = sessionStorage.getItem('ideaTitle');
    const ideaType = sessionStorage.getItem('ideaType');
    const myBrandId = sessionStorage.getItem('myBrandId');
    const targetBrandId = sessionStorage.getItem('targetBrandId');
    const messageId = sessionStorage.getItem('messageId');
    
    if (!ideaTitle) return;

    console.log('ğŸ” Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú©Ø§Ø±ÛŒ:');
    console.log('Ø§ÛŒØ¯Ù‡:', ideaTitle);
    console.log('Ù†ÙˆØ¹ Ø§ÛŒØ¯Ù‡:', ideaType);
    console.log('Ø¨Ø±Ù†Ø¯ Ù…Ù†:', myBrandId);
    console.log('Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù:', targetBrandId);
    console.log('Ù¾ÛŒØ§Ù… ID:', messageId);
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ù‡ sessionStorage
    console.log('ğŸ” Ù‡Ù…Ù‡ sessionStorage:');
    for (let i = 0; i < sessionStorage.length; i++) {
      const key = sessionStorage.key(i);
      const value = sessionStorage.getItem(key);
      console.log(`${key}: ${value}`);
    }

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    document.getElementById('sendCooperationBtn').style.display = 'none';
    document.getElementById('acceptCooperationBtn').style.display = 'none';
    document.getElementById('lockedBtn').style.display = 'none';

    // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ø§ÛŒØ¯Ù‡ - Ø±Ø§Ù‡ Ø­Ù„ Ø³Ø§Ø¯Ù‡ Ùˆ Ù…Ø·Ù…Ø¦Ù†
    // Ø§Ú¯Ø± messageId Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯ØŒ ÛŒØ¹Ù†ÛŒ Ø§ÛŒØ¯Ù‡ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø³Øª
    // Ø§Ú¯Ø± messageId Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ø¯ØŒ ÛŒØ¹Ù†ÛŒ Ø§ÛŒØ¯Ù‡ Ø®ÙˆØ¯Ù…Ø§Ù† Ø§Ø³Øª
    const isReceivedIdea = messageId && messageId !== 'null' && messageId !== 'undefined';
    
    console.log('ğŸ” ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ø§ÛŒØ¯Ù‡:');
    console.log('messageId:', messageId);
    console.log('isReceivedIdea:', isReceivedIdea);
    console.log('ideaType Ø§Ø² sessionStorage:', ideaType);
    
    if (!isReceivedIdea) {
      console.log('âœ… Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ Ø§Ø³Øª - Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„');
      
      // Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ù…ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
      document.getElementById('sendCooperationBtn').style.display = 'inline-block';
      
      // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ
      if (myBrandId && targetBrandId) {
        try {
          const response = await fetch(`/api/cooperation-status/${encodeURIComponent(ideaTitle)}`, {
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
          });

          if (response.ok) {
            const data = await response.json();
            console.log('ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ:', data.sentRequests);
            
            if (data.sentRequests && data.sentRequests.length > 0) {
              const hasPending = data.sentRequests.some(req => req.status === 'pending');
              const hasAccepted = data.sentRequests.some(req => req.status === 'accepted');
              
              if (hasAccepted) {
                document.getElementById('sendCooperationBtn').style.display = 'none';
                document.getElementById('lockedBtn').textContent = 'âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡';
                document.getElementById('lockedBtn').style.display = 'inline-block';
                console.log('âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡');
              } else if (hasPending) {
                document.getElementById('sendCooperationBtn').style.display = 'none';
                document.getElementById('lockedBtn').textContent = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø§Ø³Ø®';
                document.getElementById('lockedBtn').style.display = 'inline-block';
                console.log('â³ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø§Ø³Ø® Ø§Ø³Øª');
              }
            } else {
              console.log('ğŸ“ Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ - Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª');
            }
          }
        } catch (error) {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§:', error);
          // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø±Ø§ ÙØ¹Ø§Ù„ Ù†Ú¯Ù‡ Ø¯Ø§Ø±
        }
      } else {
        console.log('âš ï¸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯ Ù†Ø§Ù‚Øµ Ø§Ø³Øª - Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª');
      }
      
    } else {
      console.log('ğŸ“¨ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø§Ø² Ø·Ø±Ù Ø¨Ø±Ù†Ø¯ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³Øª - Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ');
      
      // Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒØŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø°ÛŒØ±ÙØªÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
      if (messageId) {
        document.getElementById('acceptCooperationBtn').style.display = 'inline-block';
        document.getElementById('acceptCooperationBtn').dataset.messageId = messageId;
      }
      
      // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ
      const response = await fetch(`/api/cooperation-status/${encodeURIComponent(ideaTitle)}`, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        
        if (data.receivedRequests && data.receivedRequests.length > 0) {
          const pendingRequest = data.receivedRequests.find(req => req.status === 'pending');
          const acceptedRequest = data.receivedRequests.find(req => req.status === 'accepted');
          
          if (acceptedRequest) {
            document.getElementById('acceptCooperationBtn').style.display = 'none';
            document.getElementById('lockedBtn').textContent = 'âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡';
            document.getElementById('lockedBtn').style.display = 'inline-block';
          } else if (pendingRequest) {
            document.getElementById('acceptCooperationBtn').style.display = 'inline-block';
            document.getElementById('acceptCooperationBtn').dataset.messageId = pendingRequest.messageId;
          }
        }
      }
    }

  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú©Ø§Ø±ÛŒ:', error);
  }
}

// Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ
async function sendCooperationRequest() {
  try {
    const targetBrandId = sessionStorage.getItem('targetBrandId');
    const ideaTitle = sessionStorage.getItem('ideaTitle');
    const ideaDescription = sessionStorage.getItem('ideaDescription');

    if (!targetBrandId || !ideaTitle) {
      alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
      return;
    }

    const response = await fetch('/api/cooperation-requests', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify({
        targetBrandId: targetBrandId,
        ideaTitle: ideaTitle,
        ideaDescription: ideaDescription
      })
    });

    if (response.ok) {
      alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
      // Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
      document.getElementById('sendCooperationBtn').style.display = 'none';
      document.getElementById('lockedBtn').textContent = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø§Ø³Ø®';
      document.getElementById('lockedBtn').style.display = 'inline-block';
    } else {
      const error = await response.json();
      alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª: ' + error.error);
    }

  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ:', error);
    alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ');
  }
}

// Ù¾Ø°ÛŒØ±ÙØªÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ
async function acceptCooperation() {
  try {
    const messageId = document.getElementById('acceptCooperationBtn').dataset.messageId;
    const ideaTitle = sessionStorage.getItem('ideaTitle');
    const ideaDescription = sessionStorage.getItem('ideaDescription');

    if (!messageId) {
      alert('Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ§Ù… ÛŒØ§ÙØª Ù†Ø´Ø¯');
      return;
    }

    const response = await fetch('/api/accept-cooperation', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify({
        messageId: messageId,
        ideaTitle: ideaTitle,
        ideaDescription: ideaDescription
      })
    });

    if (response.ok) {
      alert('Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯');
      // Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
      document.getElementById('acceptCooperationBtn').style.display = 'none';
      document.getElementById('lockedBtn').textContent = 'âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡';
      document.getElementById('lockedBtn').style.display = 'inline-block';
    } else {
      const error = await response.json();
      alert('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ Ù‡Ù…Ú©Ø§Ø±ÛŒ: ' + error.error);
    }

  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ Ù‡Ù…Ú©Ø§Ø±ÛŒ:', error);
    alert('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ Ù‡Ù…Ú©Ø§Ø±ÛŒ');
  }
}


// Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡
async function checkButtonStatus() {
  try {
    const ideaTitle = sessionStorage.getItem("ideaTitle");
    const targetBrandId = sessionStorage.getItem("targetBrandId");
    
    if (!ideaTitle || !targetBrandId) return;
    
    const response = await fetch(`/api/cooperation-requests/check/${encodeURIComponent(ideaTitle)}/${targetBrandId}`, {
      credentials: 'include'
    });
    
    if (response.ok) {
      const status = await response.json();
      const button = document.getElementById('btnCooperation');
      
      // Ø°Ø®ÛŒØ±Ù‡ Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø±ÛŒØ§ÙØªÛŒ
      if (status.receivedRequestId) {
        sessionStorage.setItem('receivedRequestId', status.receivedRequestId);
      }
      
      if (status.receivedRequestStatus === 'accepted') {
        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-check"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯';
        button.style.background = '#28a745';
      } else if (status.sentRequestStatus === 'pending') {
        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯';
        button.style.background = '#6c757d';
      } else if (status.sentRequestStatus === 'accepted') {
        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-check"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯';
        button.style.background = '#28a745';
      }
    }
  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡:', error);
  }
}

window.onload = async () => {
  // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÛŒØ¯Ù‡
  await displayIdeaInfo();
  
  // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡
  await checkButtonStatus();
  
  // Ø¯Ø±ÛŒØ§ÙØª targetBrandId Ø§Ø² sessionStorage
  let targetBrandId = sessionStorage.getItem("targetBrandId");
  console.log("ğŸ” Debug - targetBrandId from sessionStorage:", targetBrandId);
  console.log("ğŸ” Debug - current URL:", window.location.href);
  console.log("ğŸ” Debug - search params:", window.location.search);
  
  // Ø§Ú¯Ø± targetBrandId Ø¯Ø± sessionStorage Ù†ÛŒØ³ØªØŒ Ø¢Ù† Ø±Ø§ Ø§Ø² URL Ø¯Ø±ÛŒØ§ÙØª Ú©Ù† Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
  if (!targetBrandId) {
    targetBrandId = getTargetBrandId();
    console.log("ğŸ” Debug - targetBrandId from URL:", targetBrandId);
    if (targetBrandId) {
      sessionStorage.setItem("targetBrandId", targetBrandId);
      console.log("âœ… targetBrandId from URL saved to sessionStorage:", targetBrandId);
    }
  }
  
  // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² targetBrandId Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
  if (!targetBrandId) {
    const analysisDiv = document.getElementById("analysis");
    analysisDiv.innerHTML = `
      <div style="color: #e74c3c; background: #fdf2f2; padding: 15px; border-radius: 8px; border: 1px solid #fecaca;">
        <h4 style="margin: 0 0 10px 0;">âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</h4>
        <p style="margin: 0;">Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ø² ØµÙØ­Ù‡ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ ÛŒÚ© Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
        <button onclick="window.history.back()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
          ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
      </div>
    `;
    return;
  }
  
  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡
  await loadIdeaAnalysis();
  
  // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú©Ø§Ø±ÛŒ
  await checkCooperationStatus();
};

// Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÛŒØ¯Ù‡
async function displayIdeaInfo() {
  const ideaTitle = sessionStorage.getItem("ideaTitle") || "Ø¹Ù†ÙˆØ§Ù† Ø§ÛŒØ¯Ù‡";
  const ideaDescription = sessionStorage.getItem("ideaDescription") || "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§ÛŒØ¯Ù‡";
  const partnerName = sessionStorage.getItem("partnerName") || "Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±";
  
  // Ø§Ú¯Ø± Ù†Ø§Ù… Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø± Ø¯Ø± sessionStorage Ù†ÛŒØ³ØªØŒ Ø¢Ù† Ø±Ø§ Ø§Ø² API Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†
  if (partnerName === "Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±") {
    try {
      const targetBrandId = sessionStorage.getItem("targetBrandId");
      if (targetBrandId) {
        const response = await fetch(`/api/brand/${targetBrandId}`, { credentials: 'include' });
        if (response.ok) {
          const targetBrand = await response.json();
          sessionStorage.setItem("partnerName", targetBrand.name);
          document.getElementById("partnerNameDisplay").textContent = targetBrand.name;
        }
      }
    } catch (error) {
      console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯ Ù‡Ù…Ú©Ø§Ø±:", error);
    }
  } else {
    document.getElementById("partnerNameDisplay").textContent = partnerName;
  }
  
  document.getElementById("ideaTitleDisplay").textContent = ideaTitle;
  document.getElementById("ideaDescriptionDisplay").textContent = ideaDescription;
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡
  document.getElementById("pageTitle").textContent = `ØªØ­Ù„ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§ÛŒØ¯Ù‡: ${ideaTitle}`;
}
</script>
</body>
</html>
