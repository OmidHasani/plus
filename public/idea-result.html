<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ù„ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§ÛŒØ¯Ù‡</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #f4f6f9;
      max-width: 950px;
      margin: 40px auto;
      padding: 20px;
      color: #333;
      line-height: 1.9;
    }
    h1 {
      text-align: center;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
      margin-bottom: 30px;
      color: #2c3e50;
    }
    .section {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    .section h2 {
      color: #0057a3;
      font-size: 20px;
      margin-bottom: 15px;
    }
    .section h3 {
      color: #1f3b73;
      font-size: 18px;
      margin: 20px 0 10px;
    }
    .analysis-text {
      font-size: 16px;
      color: #444;
      margin-bottom: 15px;
    }
    .impact-list {
      list-style-type: disc;
      padding-right: 20px;
      font-size: 16px;
      color: #333;
    }
    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      margin: 10px 5px 0 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { 
      background: #217dbb; 
    }
    .btn-red {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      margin: 10px 5px 0 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn-red:hover { 
      background: #c0392b; 
    }
    .btn-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .popup-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow: hidden;
      animation: slideIn 0.3s ease;
    }

    .popup-header {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .popup-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }

    .popup-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s ease;
    }

    .popup-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .popup-body {
      padding: 25px;
      text-align: center;
    }

    .popup-body p {
      margin: 0;
      font-size: 16px;
      line-height: 1.6;
      color: #333;
    }

    .popup-footer {
      padding: 20px;
      text-align: center;
      border-top: 1px solid #eee;
    }

    .popup-btn {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      font-family: 'Vazirmatn', sans-serif;
    }

    .popup-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
  </style>
  
  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø²ÛŒØ¨Ø§ -->
  <div id="popup-overlay" class="popup-overlay" style="display: none;">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="popup-title">Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡</h3>
        <button class="popup-close" onclick="closePopup()">&times;</button>
      </div>
      <div class="popup-body">
        <p id="popup-message">Ù¾ÛŒØ§Ù… Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
      </div>
      <div class="popup-footer">
        <button class="popup-btn" onclick="closePopup()">Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…</button>
      </div>
    </div>
  </div>
</head>
<body>

<h1>ØªØ­Ù„ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§ÛŒØ¯Ù‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ</h1>

<div class="section">
  <h2>Ú†Ø±Ø§ Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ø² Ø²Ø§ÙˆÛŒÙ‡ CSRØŒ PR Ùˆ Branding Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø±Ø¯ØŸ</h2>
  <div id="analysis" class="analysis-text">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª ØªØ­Ù„ÛŒÙ„...</div>
</div>


<div class="btn-container">
  <button class="btn" id="btnSample">ğŸ“Œ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡</button>
  <button class="btn" id="btnBenefits">ğŸ¤ Ù…Ø²Ø§ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø·Ø±ÙÛŒÙ†</button>
  <button class="btn" id="btnRevenue">ğŸ’° Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ</button>
  <button class="btn" id="btnEconomy">ğŸ“Š ØªÙˆØ¬ÛŒÙ‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ</button>
  <button class="btn" id="btnStrategy">ğŸ“ˆ ÛŒÚ© Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù…</button>
  <button class="btn-red" id="btnBack">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<script>
async function fetchMyBrand() {
  const res = await fetch("/api/my-brand", { credentials: "include" });
  if (!res.ok) throw new Error("Ø¨Ø±Ù†Ø¯ Ø´Ù…Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
  return await res.json();
}

function getTargetBrandId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("target");
}

async function callOpenAI(prompt, myBrandId, targetBrandId) {
  const res = await fetch("/api/generate-ideas", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ 
      prompt, 
      myBrandId, 
      targetBrandId 
    })
  });

  if (!res.ok) {
    const err = await res.json();
    throw new Error(err.error?.message || "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ø³Ø® OpenAI");
  }

  const data = await res.json();
  console.log("Ø®Ø§Ù… API OpenAI:", JSON.stringify(data, null, 2));
  return data.choices[0].message.content;
}

function splitAnalysisAndImpacts(text) {
  const analysis = text.trim();
  return { analysis };
}

function showFallbackAnalysis(ideaPrompt) {
  const analysisDiv = document.getElementById("analysis");
  
  // ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ùˆ Ú©Ù„ÛŒ
  analysisDiv.innerHTML = `
    <div style="color: #2c3e50; background: #ecf0f1; padding: 15px; border-radius: 8px; border: 1px solid #bdc3c7;">
      <h4 style="margin: 0 0 10px 0;">ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ Ø§ÛŒØ¯Ù‡</h4>
      <p style="margin: 0;">Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø§Ø² Ø²ÙˆØ§ÛŒØ§ÛŒ Ù…Ø®ØªÙ„Ù (CSRØŒ PRØŒ Branding) Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³Øª Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ùˆ Ø¨Ø±Ù†Ø¯ Ù…Ø²Ø§ÛŒØ§ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ÛŒ Ø¨Ù‡ Ù‡Ù…Ø±Ø§Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.</p>
    </div>
  `;
}

async function loadIdeaAnalysis() {
  const ideaPrompt = sessionStorage.getItem("ideaPrompt");
  const analysisDiv = document.getElementById("analysis");

  // Ø§Ú¯Ø± Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± sessionStorage Ù†ÛŒØ³ØªØŒ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
  if (!ideaPrompt) {
    analysisDiv.innerHTML = `
      <div style="color: #f39c12; background: #fef9e7; padding: 15px; border-radius: 8px; border: 1px solid #f4d03f;">
        <h4 style="margin: 0 0 10px 0;">âš ï¸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÛŒØ¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯</h4>
        <p style="margin: 0;">Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ø² ØµÙØ­Ù‡ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ ÛŒÚ© Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
        <button onclick="window.history.back()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
          ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
      </div>
    `;
    return;
  }

  try {
    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§
    const myBrand = await fetchMyBrand();
    console.log("ğŸ” Debug - myBrand:", myBrand);
    
    let targetBrandId = sessionStorage.getItem("targetBrandId");
    console.log("ğŸ” Debug - targetBrandId from sessionStorage:", targetBrandId);
    
    if (!targetBrandId) {
      throw new Error("Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù ÛŒØ§ÙØª Ù†Ø´Ø¯.");
    }

    const newPrompt = `
Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ±:
${ideaPrompt}

ÛŒÚ© ØªØ­Ù„ÛŒÙ„ ØºÙ†ÛŒ Ùˆ Ù¾Ø±Ù…Ø­ØªÙˆØ§ (Û´â€“Ûµ Ø®Ø·) Ø¨Ù†ÙˆÛŒØ³ Ú©Ù‡ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡Ø¯ Ú†Ø±Ø§ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø²Ø§ÙˆÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ (CSR)ØŒ Ø±ÙˆØ§Ø¨Ø· Ø¹Ù…ÙˆÙ…ÛŒ (PR) Ùˆ Ø¨Ø±Ù†Ø¯Ø³Ø§Ø²ÛŒ (Branding) Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯. Ø§ÛŒÙ† ØªØ­Ù„ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø¹Ù…ÛŒÙ‚ Ùˆ Ù…ØªÙ‚Ø§Ø¹Ø¯Ú©Ù†Ù†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ Ùˆ Ù…Ø²Ø§ÛŒØ§ÛŒ Ø§ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ø§Ø² Ù‡Ø± Ø³Ù‡ Ø²Ø§ÙˆÛŒÙ‡ Ø¨Ù‡ Ø·ÙˆØ± Ø¬Ø§Ù…Ø¹ Ù¾ÙˆØ´Ø´ Ø¯Ù‡Ø¯.

Ù‡ÛŒÚ† Ù…Ù‚Ø¯Ù…Ù‡ ÛŒØ§ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ù†ÙˆÛŒØ³. ÙÙ‚Ø· Ù‡Ù…ÛŒÙ† ØªØ­Ù„ÛŒÙ„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³.
`;

    analysisDiv.textContent = "â³ Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...";
    const response = await callOpenAI(newPrompt, myBrand._id, targetBrandId);
    const { analysis } = splitAnalysisAndImpacts(response);

    analysisDiv.innerHTML = analysis.replace(/\n/g, "<br>");
  } catch (err) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡:", err);
    
    // Ø§Ú¯Ø± Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø§Ø³ØªØŒ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    if (err.message.includes("Ø³Ø±ÙˆÛŒØ³ ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ù…ÙˆÙ‚ØªØ§Ù‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª") || err.message.includes("Ø®Ø·Ø§ Ø¯Ø± API")) {
      // Ù†Ù…Ø§ÛŒØ´ ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§
      showFallbackAnalysis(ideaPrompt);
    } else {
      analysisDiv.innerHTML = `
        <div style="color: #e74c3c; background: #fdf2f2; padding: 15px; border-radius: 8px; border: 1px solid #fecaca;">
          <h4 style="margin: 0 0 10px 0;">âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡</h4>
          <p style="margin: 0;">${err.message}</p>
          <button onclick="loadIdeaAnalysis()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
            ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
          </button>
        </div>
      `;
    }
  }
}

// ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§Ù¾â€ŒØ¢Ù¾
function showPopup(title, message) {
  document.getElementById('popup-title').textContent = title;
  document.getElementById('popup-message').textContent = message;
  document.getElementById('popup-overlay').style.display = 'flex';
}

function closePopup() {
  document.getElementById('popup-overlay').style.display = 'none';
}

document.getElementById("btnEconomy").addEventListener("click", () => {
  showPopup("ğŸ“Š ØªÙˆØ¬ÛŒÙ‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ØªÙˆØ¬ÛŒÙ‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ú©Ø§Ù…Ù„ Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnSample").addEventListener("click", () => {
  showPopup("ğŸ“Œ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ù…Ø´Ø§Ø¨Ù‡ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.");
});

document.getElementById("btnBenefits").addEventListener("click", () => {
  showPopup("ğŸ¤ Ù…Ø²Ø§ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø·Ø±ÙÛŒÙ†", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ø²Ø§ÛŒØ§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnRevenue").addEventListener("click", () => {
  showPopup("ğŸ’° Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnStrategy").addEventListener("click", () => {
  showPopup("ğŸ“ˆ ÛŒÚ© Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù…", "Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ùˆ Ø¬Ø²Ø¦ÛŒ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.");
});

document.getElementById("btnBack").addEventListener("click", () => {
  window.history.back();
});

window.onload = async () => {
  // Ø¯Ø±ÛŒØ§ÙØª targetBrandId Ø§Ø² sessionStorage
  let targetBrandId = sessionStorage.getItem("targetBrandId");
  console.log("ğŸ” Debug - targetBrandId from sessionStorage:", targetBrandId);
  console.log("ğŸ” Debug - current URL:", window.location.href);
  console.log("ğŸ” Debug - search params:", window.location.search);
  
  // Ø§Ú¯Ø± targetBrandId Ø¯Ø± sessionStorage Ù†ÛŒØ³ØªØŒ Ø¢Ù† Ø±Ø§ Ø§Ø² URL Ø¯Ø±ÛŒØ§ÙØª Ú©Ù† Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
  if (!targetBrandId) {
    targetBrandId = getTargetBrandId();
    console.log("ğŸ” Debug - targetBrandId from URL:", targetBrandId);
    if (targetBrandId) {
      sessionStorage.setItem("targetBrandId", targetBrandId);
      console.log("âœ… targetBrandId from URL saved to sessionStorage:", targetBrandId);
    }
  }
  
  // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² targetBrandId Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
  if (!targetBrandId) {
    const analysisDiv = document.getElementById("analysis");
    analysisDiv.innerHTML = `
      <div style="color: #e74c3c; background: #fdf2f2; padding: 15px; border-radius: 8px; border: 1px solid #fecaca;">
        <h4 style="margin: 0 0 10px 0;">âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</h4>
        <p style="margin: 0;">Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø±Ù†Ø¯ Ù‡Ø¯Ù ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ø² ØµÙØ­Ù‡ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ ÛŒÚ© Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
        <button onclick="window.history.back()" style="margin-top: 10px; padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
          ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
      </div>
    `;
    return;
  }
  
  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡
  await loadIdeaAnalysis();
};
</script>
</body>
</html>
