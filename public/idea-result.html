<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تحلیل حرفه‌ای ایده</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #f4f6f9;
      max-width: 950px;
      margin: 40px auto;
      padding: 20px;
      color: #333;
      line-height: 1.9;
    }
    h1 {
      text-align: center;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
      margin-bottom: 30px;
      color: #2c3e50;
    }
    .section {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    .section h2 {
      color: #0057a3;
      font-size: 20px;
      margin-bottom: 15px;
    }
    .section h3 {
      color: #1f3b73;
      font-size: 18px;
      margin: 20px 0 10px;
    }
    .analysis-text {
      font-size: 16px;
      color: #444;
      margin-bottom: 15px;
    }
    .impact-list {
      list-style-type: disc;
      padding-right: 20px;
      font-size: 16px;
      color: #333;
    }
    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      margin: 10px 5px 0 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { background: #217dbb; }
  </style>
</head>
<body>

<h1>تحلیل حرفه‌ای ایده همکاری</h1>

<div class="section">
  <h2>چرا باید این ایده را از زاویه CSR، PR و Branding بررسی کرد؟</h2>
  <div id="analysis" class="analysis-text">⏳ در حال دریافت تحلیل...</div>
</div>

<div class="section">
  <h2>اتفاقات و دستاوردهای این همکاری برای دو برند</h2>
  <div id="impactList">
    <h3>مسئولیت اجتماعی (CSR)</h3>
    <ul id="csrList" class="impact-list"></ul>
    <h3>روابط عمومی (PR)</h3>
    <ul id="prList" class="impact-list"></ul>
    <h3>برندسازی (Branding)</h3>
    <ul id="brandingList" class="impact-list"></ul>
  </div>
</div>

<div class="section">
  <h2> استراتژی </h2>
  <div id="strategy" class="analysis-text">برای دریافت استراتژی، روی دکمه "یک استراتژی می‌خواهم" کلیک کنید.</div>
</div>

<div style="margin-top:20px;">
  <button class="btn" id="btnEconomy">💰 توجیه اقتصادی</button>
  <button class="btn" id="btnSample">📌 نمونه‌های اجرا شده</button>
  <button class="btn" id="btnStrategy">📈 یک استراتژی می‌خواهم</button>
</div>

<script>
async function callOpenAI(prompt) {
  const res = await fetch("/api/generate-ideas", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ prompt })
  });
  if (!res.ok) throw new Error("خطا در API");
  const data = await res.json();
  return data.choices[0].message.content;
}

function splitAnalysisAndImpacts(text) {
  const parts = text.split(/CSR:|PR:|Branding:/);
  const analysis = parts[0].trim();
  const csr = parts[1] ? parts[1].split("\n").filter(l => l.trim()) : [];
  const pr = parts[2] ? parts[2].split("\n").filter(l => l.trim()) : [];
  const branding = parts[3] ? parts[3].split("\n").filter(l => l.trim()) : [];
  return { analysis, csr, pr, branding };
}

async function loadIdeaAnalysis() {
  const ideaPrompt = sessionStorage.getItem("ideaPrompt");
  const analysisDiv = document.getElementById("analysis");
  const csrList = document.getElementById("csrList");
  const prList = document.getElementById("prList");
  const brandingList = document.getElementById("brandingList");

  try {
    const newPrompt = `
بر اساس اطلاعات زیر:
${ideaPrompt}

خروجی حرفه‌ای و کامل بده و فقط این دو بخش را بنویس:

1. **یک تحلیل غنی و پرمحتوا (۴–۵ خط)** که توضیح دهد چرا این ایده باید از زاویه‌های مسئولیت اجتماعی (CSR)، روابط عمومی (PR) و برندسازی (Branding) بررسی شود. این بخش باید عمیق و متقاعدکننده باشد.

2. سپس سه لیست مجزا و بسیار مفصل:
- **CSR:** تمام اتفاقات و دستاوردهایی که از منظر مسئولیت اجتماعی برای دو برند رخ می‌دهد (حداقل ۵–۷ مورد دقیق و واقعی).
- **PR:** تمام اتفاقات و دستاوردهایی که از منظر روابط عمومی برای دو برند رخ می‌دهد (حداقل ۵–۷ مورد دقیق و واقعی).
- **Branding:** تمام اتفاقات و دستاوردهایی که از منظر برندسازی برای دو برند رخ می‌دهد (حداقل ۵–۷ مورد دقیق و واقعی).

هیچ مقدمه یا نتیجه‌گیری اضافه ننویس. خروجی فقط همین دو بخش باشد.
`;

    analysisDiv.textContent = "⏳ در حال تحلیل...";
    const response = await callOpenAI(newPrompt);
    const { analysis, csr, pr, branding } = splitAnalysisAndImpacts(response);

    analysisDiv.innerHTML = analysis.replace(/\n/g, "<br>");
    csrList.innerHTML = csr.map(i => `<li>${i.replace(/^[-*•]\s*/, '')}</li>`).join("");
    prList.innerHTML = pr.map(i => `<li>${i.replace(/^[-*•]\s*/, '')}</li>`).join("");
    brandingList.innerHTML = branding.map(i => `<li>${i.replace(/^[-*•]\s*/, '')}</li>`).join("");
  } catch (err) {
    analysisDiv.textContent = "❌ خطا: " + err.message;
  }
}

document.getElementById("btnEconomy").addEventListener("click", async () => {
  const ideaPrompt = sessionStorage.getItem("ideaPrompt");
  const analysisDiv = document.getElementById("analysis");
  analysisDiv.textContent = "⏳ در حال تحلیل اقتصادی...";
  const response = await callOpenAI(ideaPrompt + "\n\nلطفاً توجیه اقتصادی کامل این ایده را تحلیل کن.");
  analysisDiv.innerHTML = response.replace(/\n/g, "<br>");
});

document.getElementById("btnSample").addEventListener("click", async () => {
  const ideaPrompt = sessionStorage.getItem("ideaPrompt");
  const analysisDiv = document.getElementById("analysis");
  analysisDiv.textContent = "⏳ در حال جستجوی نمونه‌های مشابه...";
  const response = await callOpenAI(ideaPrompt + "\n\nنمونه‌های واقعی مشابه این ایده را در ایران یا جهان معرفی کن و نتایجشان را توضیح بده.");
  analysisDiv.innerHTML = response.replace(/\n/g, "<br>");
});

document.getElementById("btnStrategy").addEventListener("click", async () => {
  const ideaPrompt = sessionStorage.getItem("ideaPrompt");
  const strategyDiv = document.getElementById("strategy");
  strategyDiv.textContent = "⏳ در حال طراحی استراتژی...";
  const strategyPrompt = `
شما در نقش یک **مدیر بازاریابی ارشد (CMO)** و **توسعه‌دهنده حرفه‌ای کسب‌وکار (Business Developer)** هستید.  
می‌خواهم بر اساس ایده زیر یک **استراتژی کاملاً اجرایی و فوق‌جزئی** طراحی کنید که بتوان آن را مستقیماً به تیم‌های عملیاتی و مدیران ارائه داد و اجرا کرد:  

[ایده]  
${ideaPrompt}  

**خروجی شما باید شامل این بخش‌ها باشد و هر بخش با بیشترین جزئیات ممکن نوشته شود:**

1. **بازنویسی کامل و شفاف ایده:**  
   - ایده را با بیانی کامل‌تر و جزئی‌تر بازنویسی کنید.  
   - همه ابعاد ایده، شامل هدف، روش اجرا، اجزای کلیدی و ارزش پیشنهادی را توضیح دهید.  
   - این بخش باید طوری نوشته شود که هیچ ابهامی برای تیم‌های اجرایی باقی نماند.  

2. **استراتژی اجرای ایده (بخش اصلی):**  
   - گام‌به‌گام و به ترتیب منطقی توضیح دهید که برای اجرای این ایده چه اقداماتی باید انجام شود.  
   - برای **هر گام** به طور دقیق مشخص کنید:  
     - **چه فعالیتی انجام می‌شود؟**  
     - **چه کسی (کدام بخش یا تیم) مسئول انجام آن است؟**  
     - **این مرحله چطور باید انجام شود؟ (فرآیند اجرایی جزئی)**  
     - **چه منابعی (مالی، انسانی، فنی) لازم است؟**  
     - **پیش‌نیازهای هر مرحله چیست؟**  
     - **چه خروجی مشخصی باید در پایان این گام به دست آید؟**  
   - هیچ چیز را به‌صورت کلی ننویسید؛ هر مرحله باید مثل یک دستورالعمل عملیاتی دقیق باشد.  

3. **برنامه‌ریزی منابع و تقسیم نقش‌ها:**  
   - وظایف دقیق هر برند را به تفکیک بنویسید (کدام بخش چه مسئولیتی دارد).  
   - منابع موردنیاز (مالی، انسانی، تکنولوژیک) را به تفکیک هر مرحله لیست کنید.  
   - اگر نیاز به همکاری با پیمانکاران یا شرکای خارجی وجود دارد، آن‌ها را مشخص کنید.  

4. **ریسک‌ها و راهکارها:**  
   - مهم‌ترین ریسک‌های احتمالی در اجرای این ایده را فهرست کنید.  
   - برای هر ریسک، یک راهکار مشخص و اجرایی ارائه دهید.  

5. **نتیجه‌گیری اجرایی:**  
   - توضیح دهید پس از اجرای این استراتژی چه نتایج مشخصی به دست خواهد آمد (از نظر فروش، جایگاه برند، توسعه بازار).  
   - مزیت‌های رقابتی که این ایده برای دو برند ایجاد می‌کند را به‌طور دقیق شرح دهید.  

**نکات کلیدی:**  
- **هیچ توضیح کلی و مبهمی ننویسید.** همه چیز باید دقیق، عملیاتی و با ذکر جزئیات کامل باشد.  
- لحن شما باید **حرفه‌ای و اجرایی** باشد، مثل یک راهنمای عملیاتی که به تیم‌های داخلی ارائه می‌شود.  
- خروجی شما باید مثل یک **Manual کامل اجرای پروژه** باشد.  



  `;
  const response = await callOpenAI(strategyPrompt);
  strategyDiv.innerHTML = response.replace(/\n/g, "<br>");
});

window.onload = loadIdeaAnalysis;
</script>
</body>
</html>
