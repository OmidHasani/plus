<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تایید ایمیل</title>
  <style>
    body { font-family: Vazir, sans-serif; padding: 40px; background: #f0f9fb; color: #065a60; }
    .container { max-width: 400px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 6px 18px rgb(0 0 0 / 0.1); text-align: center; }
    button { background: #00b4c4; color: white; border: none; padding: 12px 20px; font-size: 1rem; border-radius: 8px; cursor: pointer; margin-top: 20px; }
    button:hover { background: #028a9b; }
  </style>
</head>
<body>
  <div class="container">
    <h1>در حال تایید ایمیل...</h1>
    <p id="message">لطفا کمی صبر کنید</p>
    <button id="loginBtn" style="display:none" onclick="goToLogin()">ورود به سایت</button>
  </div>

  <script>
    async function verifyEmail(token, email) {
      try {
        const response = await fetch(`/api/verify-email?token=${encodeURIComponent(token)}&email=${encodeURIComponent(email)}`);
        if (response.ok) {
          document.getElementById('message').textContent = 'ایمیل شما با موفقیت تایید شد.';
          document.getElementById('loginBtn').style.display = 'inline-block';
        } else {
          const text = await response.text();
          document.getElementById('message').textContent = 'خطا در تایید ایمیل: ' + text;
        }
      } catch (err) {
        document.getElementById('message').textContent = 'خطا در ارتباط با سرور';
      }
    }

    function goToLogin() {
      window.location.href = '/'; // یا صفحه ورود سایت شما
    }

    // گرفتن پارامترهای URL
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const email = params.get('email');

    if (token && email) {
      verifyEmail(token, email);
    } else {
      document.getElementById('message').textContent = 'لینک تایید نامعتبر است.';
    }
  </script>
</body>
</html>
