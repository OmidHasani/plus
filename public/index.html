<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ÙØ±Ù… Ø«Ø¨Øª Ø¨Ø±Ù†Ø¯</title>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap');
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #f8faff;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      direction: rtl;
      line-height: 1.8;
      color: #222;
    }
    h2, h3 {
      color: #1e3a8a;
      margin-bottom: 15px;
    }
    .form-row {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    /* Ø§Ø¬Ø¨Ø§Ø± ÙÙˆÙ†Øª Ùˆ ÛŒÚ©Ø¯Ø³ØªÛŒ Ù‡Ù…Ù‡ Ù…ØªÙ†â€ŒÙ‡Ø§ */
    textarea,
    .dropdown-toggle,
    .dropdown-menu div,
    .priority-item span {
      font-family: 'Vazirmatn', sans-serif !important;
      font-size: 15px;
      color: #1e293b;
    }

    /* Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¸Ø§Ù‡Ø± Ø¨Ù‡ØªØ± Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ù„ÙˆØ¯ Ø´Ø¯Ù‡ */
    textarea {
      font-weight: 400;
      line-height: 1.8;
    }
    .priority-item span:first-child {
      font-weight: 500;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #e2e8f0;
    }
    .tab {
      padding: 12px 24px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      color: #64748b;
      transition: all 0.2s ease;
    }
    .tab.active {
      color: #1e3a8a;
      border-bottom-color: #1e3a8a;
    }
    .tab:hover {
      color: #1e3a8a;
    }

    /* Dropdown */
    .dropdown {
      position: relative;
    }
    .dropdown-toggle {
      padding: 12px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      cursor: pointer;
      background: #fff;
      font-size: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      transition: all 0.2s ease;
    }
    .dropdown-toggle:hover {
      border-color: #3b82f6;
    }
    .dropdown-menu {
      position: absolute;
      width: 100%;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      background: #fff;
      display: none;
      z-index: 100;
      margin-top: 5px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .dropdown-menu div {
      padding: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .dropdown-menu div:hover {
      background: #f1f5f9;
    }

    /* Questions */
    .section {
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 15px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .section strong {
      display: block;
      margin-bottom: 8px;
      color: #1e293b;
      font-weight: 500;
    }
    textarea {
      width: 100%;
      height: 100px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 8px;
      resize: vertical;
      font-size: 14px;
      outline: none;
      background: #f9fafb;
      transition: border 0.2s;
    }
    textarea:focus {
      border-color: #3b82f6;
      background: #fff;
    }

    /* Priorities */
    #priority-list {
      margin-top: 10px;
    }
    .priority-item {
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      background-color: #fff;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .priority-number {
      font-weight: bold;
      color: #3b82f6;
    }

    /* Save button */
    .save-button {
      background: #2563eb;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background 0.2s ease;
      display: block;
      margin-top: 20px;
    }
    .save-button:hover {
      background: #1e40af;
    }

    .hidden { display: none; }
    .form-instruction {
      font-weight: 600;
      font-size: 18px;
      margin: 25px 0 20px;
      color: #1e293b;
      text-align: right;
    }
    .section-divider {
      border-bottom: 1px solid #e2e8f0;
      margin: 20px 0;
    }
  </style>
</head>
<body>
<div style="text-align:left; margin-bottom: 20px; padding: 10px; background: #f1f5f9; border-radius: 8px;">
  <span id="userStatus" style="color: #64748b; font-weight: 500;"></span>
  <button onclick="logout()" style="margin-left: 10px; background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-family: 'Vazirmatn', sans-serif;">Ø®Ø±ÙˆØ¬</button>
</div>

<h2>ğŸ“ ÙØ±Ù… Ø«Ø¨Øª Ø¨Ø±Ù†Ø¯</h2>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" onclick="switchTab('essentials')">ğŸ“‹ Ù…Ù„Ø²ÙˆÙ…Ø§Øª</div>
  <div class="tab" onclick="switchTab('extra')">â• ØªÚ©Ù…ÛŒÙ„ÛŒ</div>
  <div class="tab" onclick="switchTab('priority')">ğŸ¯ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§</div>
</div>

<!-- Essentials Tab -->
<div id="essentials-tab">
  <div class="form-row">
    <label>ğŸ­ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØµÙ†Ø¹Øª:</label>
    <div class="dropdown" id="industry-dropdown">
      <div class="dropdown-toggle" onclick="toggleMenu('industry')">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
      <div class="dropdown-menu" id="industry-menu">
        <!-- Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ø³Ø±ÙˆØ± Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
      </div>
    </div>
  </div>

  <div class="form-row">
    <label>ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ù†ÛŒØ±ÙˆÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ:</label>
    <div class="dropdown" id="staff-dropdown">
      <div class="dropdown-toggle" onclick="toggleMenu('staff')">Û±â€“Û±Û° Ù†ÙØ± â–¼</div>
      <div class="dropdown-menu" id="staff-menu">
        <div onclick="selectOption('staff', 'Û±â€“Û±Û° Ù†ÙØ±')">Û±â€“Û±Û° Ù†ÙØ±</div>
        <div onclick="selectOption('staff', 'Û±Û±â€“ÛµÛ° Ù†ÙØ±')">Û±Û±â€“ÛµÛ° Ù†ÙØ±</div>
        <div onclick="selectOption('staff', 'ÛµÛ±â€“Û²Û°Û° Ù†ÙØ±')">ÛµÛ±â€“Û²Û°Û° Ù†ÙØ±</div>
      </div>
    </div>
  </div>

  <div class="section-divider"></div>
  <div class="form-instruction">ğŸ“ Ù„Ø·ÙØ§Ù‹ Ø³Ø¤Ø§Ù„Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯:</div>

  <div id="essentials-questions"></div>
  <button class="save-button" onclick="goToTab('extra')">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø§Ø¯Ø§Ù…Ù‡</button>
</div>

<!-- Extra Tab -->
<div id="extra-tab" class="hidden">
  <div class="form-instruction">ğŸ“ Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø¯ØŒ Ø³Ø¤Ø§Ù„Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯:</div>
  <div id="extra-questions"></div>
  <button class="save-button" onclick="goToTab('priority')">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø§Ø¯Ø§Ù…Ù‡</button>
</div>

<!-- Priority Tab -->
<div id="priority-tab" class="hidden">
  <div class="form-instruction">ğŸ¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø±Ù†Ø¯ Ø®ÙˆØ¯ Ù…Ø±ØªØ¨ Ú©Ù†ÛŒØ¯:</div>
  <div id="priority-list">
    <div class="priority-item"><span class="priority-text">ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ø¨Ø§Ø²Ø§Ø±</span><span class="priority-number">1</span></div>
    <div class="priority-item"><span class="priority-text">Ø¬Ø°Ø¨ Ø³Ø±Ù…Ø§ÛŒÙ‡</span><span class="priority-number">2</span></div>
    <div class="priority-item"><span class="priority-text">Ø¨Ù‡Ø¨ÙˆØ¯ Ø®Ø¯Ù…Ø§Øª Ù…Ø´ØªØ±ÛŒ</span><span class="priority-number">3</span></div>
    <div class="priority-item"><span class="priority-text">ØªÙˆØ³Ø¹Ù‡ Ù…Ø­ØµÙˆÙ„</span><span class="priority-number">4</span></div>
    <div class="priority-item"><span class="priority-text">Ø§ÙØ²Ø§ÛŒØ´ ÙØ±ÙˆØ´</span><span class="priority-number">5</span></div>
    <div class="priority-item"><span class="priority-text">ØªÙˆØ³Ø¹Ù‡ ØªÛŒÙ…</span><span class="priority-number">6</span></div>
    <div class="priority-item"><span class="priority-text">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø± Ø¬Ø¯ÛŒØ¯</span><span class="priority-number">7</span></div>
    <div class="priority-item"><span class="priority-text">ØªØ¨Ù„ÛŒØºØ§Øª Ùˆ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ</span><span class="priority-number">8</span></div>
    <div class="priority-item"><span class="priority-text">Ø§Ø±ØªÙ‚Ø§Ø¡ ÙÙ†Ø§ÙˆØ±ÛŒ</span><span class="priority-number">9</span></div>
  </div>
  <button class="save-button" onclick="exportData()">âœ… Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
</div>

<script>
/********************  Ù¾Ø±Ø³Ø´â€ŒÙ‡Ø§  ********************/
// Essentials (Ø³Ø¤Ø§Ù„Ø§Øª 1 ØªØ§ 30)
const essentialsQuestions = [
  {id: 1,  q: "Ø¨Ø±Ù†Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ù…Ø¹Ø±ÙÛŒ Ú©Ù†ÛŒØ¯.",                              ph: "Ù…Ø§ Ù¾Ù„ØªÙØ±Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡ Ù‡Ø³ØªÛŒÙ… ..."},
  {id: 2,  q: "Ú†Ù‡ Ø¬Ø§ÛŒÚ¯Ø§Ù‡ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø¯Ø§Ø±ÛŒØ¯ØŸ",                                      ph: "Ù…Ø§ Ø¨Ø±Ù†Ø¯ Ù…Ù‚Ø±ÙˆÙ†â€ŒØ¨Ù‡â€ŒØµØ±ÙÙ‡ Ù‡Ø³ØªÛŒÙ… ..."},
  {id: 3,  q: "Ø¯Ø± Ú†Ù‡ ÙØ§Ø²ÛŒ Ø§Ø² Ø±Ø´Ø¯ Ù‡Ø³ØªÛŒØ¯ØŸ",                                        ph: "", type: "dropdown", options: ["Ø´Ø±ÙˆØ¹", "ØªØ«Ø¨ÛŒØª", "Ø±Ø´Ø¯ Ø³Ø±ÛŒØ¹", "Ø¨Ù„ÙˆØº", "Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ"]},
  {id: 4,  q: "Û³ Ø§ÙˆÙ„ÙˆÛŒØª Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø¯ØªØ§Ù† Ø¯Ø± Û±Û² Ù…Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ Ú†ÛŒØ³ØªØŸ (Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§Ù‡Ù…ÛŒØª)",        ph: "Û±. ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¬Ù†ÙˆØ¨ Ú©Ø´ÙˆØ±ØŒ Û². ..."},
  {id: 5,  q: "Ø¯Ø± Ú†Ù‡ Ú†ÛŒØ²Ù‡Ø§ÛŒÛŒ Ø­Ø§Ø¶Ø±ÛŒØ¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯ØŸ (Ù¾ÙˆÙ„ØŒ Ø²Ù…Ø§Ù†ØŒ Ø§Ø¹ØªØ¨Ø§Ø±)",        ph: "ÙˆÙ‚Øª Ùˆ Ø¨ÙˆØ¯Ø¬Ù‡ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ Ø§Ø®ØªØµØ§Øµ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… ..."},
  // ğŸ”» Ø¨Ø®Ø´ Ù…Ø­ØµÙˆÙ„ / Ø®Ø¯Ù…Ø§Øª / Ù…Ø¯Ù„ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±
  {id: 6,  q: "Ù…Ø­ØµÙˆÙ„Ø§Øª / Ø®Ø¯Ù…Ø§Øª Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ Ú†ÛŒØ³ØªØŸ (Ø¨Ø§ ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡)",                   ph: "ÛŒÚ© Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± CRM Ø¯Ø§Ø±ÛŒÙ… ..."},
  {id: 7,  q: "Ú†Ø·ÙˆØ± Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸ",                                            ph: "Ø§Ø² ÙØ±ÙˆØ´ Ø§Ø´ØªØ±Ø§Ú© Ø³Ø§Ù„Ø§Ù†Ù‡ ..."},
  {id: 8,  q: "Ú©Ø¯Ø§Ù…â€ŒÛŒÚ© Ø§Ø² Ù…Ø­ØµÙˆÙ„Ø§ØªØªØ§Ù† Ù‚Ø§Ø¨Ù„ÛŒØª ØªØ±Ú©ÛŒØ¨ Ø¨Ø§ Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø±Ø§ Ø¯Ø§Ø±Ø¯ØŸ",      ph: "Ù¾Ú©ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´ Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ..."},
  {id: 9,  q: "Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØªØ§Ù† Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³ØªØŸ",                          ph: "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ù…Ø§ ..."},
  {id: 10, q: "Ø§Ø² Ú†Ù‡ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒÛŒ ÙØ±ÙˆØ´ Ø¯Ø§Ø±ÛŒØ¯ØŸ",                                      ph: "Û¸Û°Ùª Ø³Ø§ÛŒØªØŒ Û²Û°Ùª Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡ ÙØ±ÙˆØ´ ..."},
  {id: 11, q: "Ù…Ø­ØµÙˆÙ„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø¨Ø´Ù‡ Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ù‡Ø¯ÛŒÙ‡ ÛŒØ§ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯ØŸ", ph: "Ù¾Ú©ÛŒØ¬ ÛŒÚ©â€ŒÙ…Ø§Ù‡Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† ..."},
  // ğŸ”» Ø¨Ø®Ø´ Ù…Ù†Ø§Ø¨Ø¹ Ùˆ Ø¸Ø±ÙÛŒØªâ€ŒÙ‡Ø§
  {id: 12, q: "Ú†Ù‡ Ø¸Ø±ÙÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¯Ø± Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù…Ø´ØªØ±Ú© Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯ØŸ",     ph: "ÛŒÚ© ÙØ¶Ø§ÛŒ Ø§Ø¯Ø§Ø±ÛŒ Û´Û° Ù…ØªØ±ÛŒ ..."},
  {id: 13, q: "Ú©Ø¯Ø§Ù… Ù…Ù†Ø§Ø¨Ø¹ ÙØ¹Ù„Ø§Ù‹ Ú©Ù…ØªØ± Ø§Ø² Ø¸Ø±ÙÛŒØª ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŸ",             ph: "Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù… ÛµÛ°Û°Û° Ù†ÙØ±Ù‡ ..."},
  {id: 14, q: "Ø¢ÛŒØ§ Ù…Ø¬Ø§Ø² Ø¨Ù‡ Ø§Ø±Ø§Ø¦Ù‡ Ø§ÛŒÙ† Ù…Ù†Ø§Ø¨Ø¹ Ø¨Ù‡ Ø¨ÛŒØ±ÙˆÙ† Ù‡Ø³ØªÛŒØ¯ØŸ",                      ph: "Ø¨Ù„Ù‡ØŒ ÙˆÙ„ÛŒ ÙÙ‚Ø· Ø¯Ø± Ù‡Ù…Ú©Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø³Ù…ÛŒ ..."},
  // ğŸ”» Ø¨Ø®Ø´ Ù…Ø®Ø§Ø·Ø¨â€ŒØ´Ù†Ø§Ø³ÛŒ
  {id: 15, q: "Ù…Ø´ØªØ±ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ø´Ù…Ø§ Ú©ÛŒØ³ØªØŸ (Ø³Ù†ØŒ ØµÙ†Ø¹ØªØŒ Ø±ÙØªØ§Ø±ØŒ Ø¯ØºØ¯ØºÙ‡ ...)",             ph: "Ø²Ù†Ø§Ù† Û²Ûµ ØªØ§ Û´Û° Ø³Ø§Ù„Ù‡ Ø´Ø§ØºÙ„ ..."},
  {id: 16, q: "Ø¨ÛŒØ´ØªØ± Ù…Ø´ØªØ±ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ú©Ø¬Ø§ Ø¬Ø°Ø¨ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŸ",                               ph: "Û·Û°Ùª Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… ..."},
  {id: 17, q: "ØªØ¹Ø¯Ø§Ø¯ Ù…Ø®Ø§Ø·Ø¨ÛŒÙ† ÙØ¹Ø§Ù„ Ø´Ù…Ø§ Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ",                                  ph: "Û²Û°Û°Û° Ù…Ø´ØªØ±ÛŒ ÙØ¹Ø§Ù„ ..."},
  {id: 18, q: "Ù…Ø®Ø§Ø·Ø¨ÛŒÙ† Ø´Ù…Ø§ Ø¨ÛŒØ´ØªØ± Ú†Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒ Ø±ÙˆØ§Ù†ÛŒâ€ŒØ§ÛŒ Ø¯Ø§Ø±Ù†Ø¯ØŸ",                      ph: "Ù†ÙˆØ¢ÙˆØ± Ùˆ Ø§Ù‡Ù„ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙˆØ®Ø·Ø§ ..."},
  {id: 19, q: "Ù…Ø®Ø§Ø·Ø¨ Ø´Ù…Ø§ Ø¨Ù‡ Ú†Ù‡ Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ Ø§Ø³ØªØŸ",                      ph: "ÙØ±Ø§Ø¯Ø±Ø³ØŒ Ù…Ú©ØªØ¨â€ŒØ®ÙˆÙ†Ù‡ØŒ Ù†ÙˆÛŒÙ† ..."},
  // ğŸ”» Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø±Ù†Ø¯ Ø¨Ù‡ Ø¨Ø±Ù†Ø¯
  {id: 20, q: "ØªØ¬Ø±Ø¨Ù‡â€ŒØ§ÛŒ Ø§Ø² Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø¯Ø§Ø´ØªÛŒØ¯ØŸ",                        ph: "Ø¨Ø§ ÛŒÚ© Ø¨Ø±Ù†Ø¯ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ ..."},

  // ğŸ”» Ø³Ø¤Ø§Ù„ 27 Ùˆ 30 (Ø¬Ø²Ùˆ Ù…Ù„Ø²ÙˆÙ…Ø§Øª)
  {id: 21, q: "Ú†Ù‡ Ú†ÛŒØ²ÛŒ Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ù‡ Ø¨ÛŒØ±ÙˆÙ† Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŒ ÙˆÙ„ÛŒ Ø¯Ø± Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø®ÙˆØ¨ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø¯Ù‡ÛŒØ¯ØŸ", ph: "Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ CRM Ù…Ø´ØªØ±ÛŒØ§Ù† VIP ..."},
  {id: 22, q: "Ú†Ù‡ Ú†ÛŒØ²ÛŒ Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ ÛŒÚ© Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ù…ØªÙˆÙ‚Ù Ú©Ù†ÛŒØ¯ØŸ",                       ph: "Ù†Ø¨ÙˆØ¯ Ø´ÙØ§ÙÛŒØª Ø¯Ø± Ø§Ù‡Ø¯Ø§Ù ..."}
];

// Extra (Ø³Ø¤Ø§Ù„Ø§Øª 31 ØªØ§ 37)
const extraQuestions = [
  {id: 23, q: "Ø¨Ø±Ø§ÛŒ Ø±Ø´Ø¯ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØªØ§Ù† Ø¯Ø± ÛŒÚ© Ø³Ø§Ù„ Ø¢ÛŒÙ†Ø¯Ù‡ØŒ Ú†Ù‡ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ ÛŒØ§ Ù…Ù†Ø§Ø¨Ø¹ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø§Ù„Ø§Ù† Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ", ph: "Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ† Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ ..."},
  {id: 24, q: "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´ Ø§Ø² ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒØªØ§Ù† Ø²Ù…Ø§Ù† ÛŒØ§ Ø§Ù†Ø±Ú˜ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ Ùˆ Ú†Ø±Ø§ØŸ",            ph: "Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± ÙˆØ§ØªØ³Ø§Ù¾ ..."},
  {id: 25, q: "Ø§Ø®ÛŒØ±Ø§Ù‹ Ú†Ù‡ ÙØ±ØµØª Ù…Ù‡Ù…ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ú©Ù‡ Ø­Ø³ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ù†Ø¯Ø§Ø´ØªÙ† Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¢Ù† Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ", ph: "ÛŒÚ© Ù¾Ù„ØªÙØ±Ù… Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ Ø¨Ø²Ø±Ú¯ ..."},
  {id: 26, q: "Ø±Ù‚Ø¨Ø§ÛŒ Ø´Ù…Ø§ Ø¯Ø± Ú†Ù‡ Ø²Ù…ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡â€ŒØ§Ù†Ø¯ ÛŒØ§ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ú©Ù‡ Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø´Ø±ÙˆØ¹ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ", ph: "Ø±Ù‚ÛŒØ¨â€ŒÙ…ÙˆÙ† ÛŒÚ© Ù¾Ù„ØªÙØ±Ù… Ù…Ø¹Ø±ÙÛŒ Ù…Ø´ØªØ±ÛŒ ..."},
  {id: 27, q: "ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ú©Ø¯Ø§Ù… Ù…Ø¹ÛŒØ§Ø± ÛŒØ§ Ø´Ø§Ø®Øµ Ø¯Ø± Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØªØ§Ù† Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙˆØ¬Ù‡ Ø¨ÛŒØ´ØªØ± Ø§Ø³ØªØŸ",                 ph: "Ù†Ø±Ø® Ø¨Ø§Ø²Ú¯Ø´Øª Ù…Ø´ØªØ±ÛŒ Ù¾Ø§ÛŒÛŒÙ† ..."},
  {id: 28, q: "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¨Ø²Ø±Ú¯ØªØ±ÛŒÙ† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØªØ§Ù† Ø¯Ø§Ø±ÛŒØ¯ Ú©Ø¯Ø§Ù…Ù†Ø¯ØŸ",               ph: "Ú©Ù…Ø¨ÙˆØ¯ Ù†ÛŒØ±ÙˆÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ ..."},
  {id: 29, q: "Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù…Ø´ØªØ±ÛŒØ§Ù† Ú†Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø­ØµÙˆÙ„Ø§Øª ÛŒØ§ Ø®Ø¯Ù…Ø§Øª Ø´Ù…Ø§ Ø¯Ø§Ø±Ù†Ø¯ØŸ",                ph: "Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙˆØ¨â€ŒØ³Ø§ÛŒØª Ú©Ù†Ø¯ Ø§Ø³Øª ..."}
];

const allQuestions = [...essentialsQuestions, ...extraQuestions];
/********************  UI Functions  ********************/
function buildQuestions(containerId, questionsArr) {
  const parent = document.getElementById(containerId);
  questionsArr.forEach(({id, q, ph, type, options}) => {
    const wrap = document.createElement('div');
    wrap.className = 'section';

    wrap.innerHTML = `<strong style="display:block; margin-bottom:8px;">${id}. ${q}</strong>`;
    
    if (type === 'dropdown' && options) {
      // Ø§ÛŒØ¬Ø§Ø¯ dropdown Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 3
      const dropdownDiv = document.createElement('div');
      dropdownDiv.className = 'dropdown';
      dropdownDiv.innerHTML = `
        <div class="dropdown-toggle" onclick="toggleMenu('question-${id}')" id="question-${id}-toggle">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
        <div class="dropdown-menu" id="question-${id}-menu">
          ${options.map(option => `<div onclick="selectQuestionOption('${id}', '${option}')">${option}</div>`).join('')}
        </div>
      `;
      wrap.appendChild(dropdownDiv);
    } else {
      // Ø§ÛŒØ¬Ø§Ø¯ textarea Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ø¹Ø§Ø¯ÛŒ
      const txt = document.createElement('textarea');
      txt.id = `answer-${id}`;
      txt.placeholder = ph || '';
      wrap.appendChild(txt);
    }
    
    parent.appendChild(wrap);
  });
}

// ØªØ§Ø¨Ø¹ Ù„ÙˆØ¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
async function loadCategories() {
  try {
    const res = await fetch('/api/brand-categories', { credentials: 'include' });
    if (!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§');
    const data = await res.json();
    
    const menu = document.getElementById('industry-menu');
    menu.innerHTML = '';
    
    if (data.categories.length === 0) {
      menu.innerHTML = '<div>Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</div>';
    } else {
      data.categories.forEach(category => {
        const div = document.createElement('div');
        div.textContent = category;
        div.onclick = () => selectOption('industry', category);
        menu.appendChild(div);
      });
    }
  } catch (err) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:', err);
    // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    const menu = document.getElementById('industry-menu');
    menu.innerHTML = `
      <div onclick="selectOption('industry', 'ÙÙ†Ø§ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª')">ÙÙ†Ø§ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</div>
      <div onclick="selectOption('industry', 'ØºØ°Ø§ Ùˆ Ø¯Ø§Ø±Ùˆ')">ØºØ°Ø§ Ùˆ Ø¯Ø§Ø±Ùˆ</div>
      <div onclick="selectOption('industry', 'Ø³Ø§Ø®ØªÙ…Ø§Ù†')">Ø³Ø§Ø®ØªÙ…Ø§Ù†</div>
    `;
  }
}

// Build on load
window.addEventListener('DOMContentLoaded', () => {
  buildQuestions('essentials-questions', essentialsQuestions);
  buildQuestions('extra-questions', extraQuestions);
  loadCategories();
});

/********************  Tabs  ********************/
function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('#essentials-tab, #extra-tab, #priority-tab').forEach(div => div.classList.add('hidden'));
  if (tabName === 'essentials') {
    document.getElementById('essentials-tab').classList.remove('hidden');
    document.querySelector('.tabs .tab:nth-child(1)').classList.add('active');
  } else if (tabName === 'extra') {
    document.getElementById('extra-tab').classList.remove('hidden');
    document.querySelector('.tabs .tab:nth-child(2)').classList.add('active');
  } else {
    document.getElementById('priority-tab').classList.remove('hidden');
    document.querySelector('.tabs .tab:nth-child(3)').classList.add('active');
  }
}
function goToTab(tab) { switchTab(tab); }

/********************  Dropdowns  ********************/
function toggleMenu(type) {
  const menu = document.getElementById(`${type}-menu`);
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function selectOption(type, val) {
  document.querySelector(`#${type}-dropdown .dropdown-toggle`).innerText = val;
  document.getElementById(`${type}-menu`).style.display = 'none';
}

function selectQuestionOption(questionId, val) {
  document.getElementById(`question-${questionId}-toggle`).innerText = val;
  document.getElementById(`question-${questionId}-menu`).style.display = 'none';
}

document.addEventListener('click', e => {
  // Ø¨Ø³ØªÙ† dropdown Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
  ['industry', 'staff'].forEach(type => {
    const toggle = document.querySelector(`#${type}-dropdown .dropdown-toggle`);
    const menu = document.getElementById(`${type}-menu`);
    if (!toggle.contains(e.target) && !menu.contains(e.target)) menu.style.display = 'none';
  });
  
  // Ø¨Ø³ØªÙ† dropdown Ù‡Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª
  document.querySelectorAll('[id^="question-"][id$="-menu"]').forEach(menu => {
    const questionId = menu.id.replace('-menu', '');
    const toggle = document.getElementById(`${questionId}-toggle`);
    if (!toggle.contains(e.target) && !menu.contains(e.target)) {
      menu.style.display = 'none';
    }
  });
});

/********************  Priority Sortable  ********************/
new Sortable(document.getElementById('priority-list'), {
  animation: 150,
  onEnd: () => {
    Array.from(document.getElementById('priority-list').children).forEach((item, idx) => {
      item.querySelector('.priority-number').textContent = idx + 1;
    });
  }
});

/********************  Auth & Redirects  ********************/
window.onload = async () => {
  try {
    const authRes = await fetch('/api/check-auth', {credentials: 'include'});
    const authData = await authRes.json();
    if (!authData.authenticated) {
      alert('Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.');
      window.location.href = 'login.html';
      return;
    }
    document.getElementById('userStatus').innerText = `Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: ${authData.userId}`;

    const brandRes = await fetch('/api/check-brand', {credentials: 'include'});
    if (brandRes.ok) {
      const brandData = await brandRes.json();
      if (brandData.hasBrand) {
        alert('Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø±Ù†Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.');
        window.location.href = 'brands.html';
        return;
      }
    }
  } catch (err) { console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±:', err); }
};

/********************  Export & Save  ********************/
async function exportData() {
  const brandName = prompt('Ù†Ø§Ù… Ø¨Ø±Ù†Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
  if (!brandName) return alert('Ù†Ø§Ù… Ø¨Ø±Ù†Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');

  const industry = document.querySelector('#industry-dropdown .dropdown-toggle').innerText;
  const staff    = document.querySelector('#staff-dropdown .dropdown-toggle').innerText;

  // Collect answers
  const qa = allQuestions.map(({id, q, type}) => {
    let ans = '';
    if (type === 'dropdown') {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ dropdown (Ø³ÙˆØ§Ù„ 3)
      const toggle = document.getElementById(`question-${id}-toggle`);
      ans = toggle ? toggle.innerText.replace(' â–¼', '') : '';
    } else {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª textarea
      const textarea = document.getElementById(`answer-${id}`);
      ans = textarea ? textarea.value.trim() : '';
    }
    return {id, question: q, answer: ans};
  });

  // Priorities
  const priorities = Array.from(document.querySelectorAll('#priority-list .priority-item'))
                          .map(item => item.querySelector('.priority-text').innerText);

  const brandData = {
    name: brandName,
    field: industry,
    staff: staff,
    questions: qa,
    priorities: priorities
  };

  try {
    const res = await fetch('/api/brands', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include',
      body: JSON.stringify(brandData)
    });
    const data = await res.json();
    if (res.ok) {
      alert(data.message || 'Ø«Ø¨Øª Ø¨Ø±Ù†Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.');
      window.location.href = 'brands.html';
    } else {
      alert(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø¨Ø±Ù†Ø¯');
    }
  } catch (err) {
    alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
  }
}

/********************  Logout  ********************/
async function logout() {
  if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
    await fetch('/api/logout', {method: 'POST', credentials: 'include'});
    window.location.href = 'login.html';
  }
}
</script>

</body>
</html>
