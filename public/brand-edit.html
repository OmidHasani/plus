<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ø±Ù†Ø¯</title>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap');
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 50%, #ffffff 100%);
      padding: 20px;
      max-width: 900px;
      margin: auto;
      direction: rtl;
      line-height: 1.8;
      color: #222;
      min-height: 100vh;
    }
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù‡Ø¯Ø± */
    .header {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
      position: relative;
      overflow: hidden;
      animation: headerSlideIn 0.8s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes headerSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 100%);
      pointer-events: none;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .header-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .header-nav {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .nav-link {
      color: white;
      text-decoration: none;
      padding: 12px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .nav-link:hover::before {
      left: 100%;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .nav-link.active {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.4);
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø®ØµÙˆØµ Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ - Ø¨Ù†ÙØ´ */
    .nav-dashboard {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%) !important;
      border: 1px solid rgba(155, 89, 182, 0.3) !important;
    }

    .nav-dashboard:hover {
      background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%) !important;
      box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4) !important;
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø®ØµÙˆØµ Ø¯Ú©Ù…Ù‡ Ù„ÛŒØ³Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§ - Ø³ÙÛŒØ¯ Ø¨Ø§ Ù…ØªÙ† Ø¢Ø¨ÛŒ */
    .nav-brands {
      background: white !important;
      color: #3498db !important;
      border: 1px solid rgba(52, 152, 219, 0.3) !important;
    }

    .nav-brands:hover {
      background: #f8f9fa !important;
      color: #2980b9 !important;
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2) !important;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .header-nav {
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .nav-link {
        padding: 10px 16px;
        font-size: 13px;
      }
    }

    h2, h3 {
      color: #1e3a8a;
      margin-bottom: 15px;
    }
    .form-row {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    /* Ø§Ø¬Ø¨Ø§Ø± ÙÙˆÙ†Øª Ùˆ ÛŒÚ©Ø¯Ø³ØªÛŒ Ù‡Ù…Ù‡ Ù…ØªÙ†â€ŒÙ‡Ø§ */
textarea,
.dropdown-toggle,
.dropdown-menu div,
.priority-item span {
  font-family: 'Vazirmatn', sans-serif !important;
  font-size: 15px;
  color: #1e293b;
}

/* Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¸Ø§Ù‡Ø± Ø¨Ù‡ØªØ± Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ù„ÙˆØ¯ Ø´Ø¯Ù‡ */
textarea {
  font-weight: 400;
  line-height: 1.8;
}
.priority-item span:first-child {
  font-weight: 500;
}

    /* Dropdown */
    .dropdown {
      position: relative;
    }
    .dropdown-toggle {
      padding: 12px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      cursor: pointer;
      background: #fff;
      font-size: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      transition: all 0.2s ease;
    }
    .dropdown-toggle:hover {
      border-color: #3b82f6;
    }
    .dropdown-menu {
      position: absolute;
      width: 100%;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      background: #fff;
      display: none;
      z-index: 100;
      margin-top: 5px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .dropdown-menu div {
      padding: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .dropdown-menu div:hover {
      background: #f1f5f9;
    }

    /* Tag Input Styles */
    .tag-input-container {
      margin-top: 10px;
    }
    
    .tag-input-wrapper {
      position: relative;
    }
    
    .tag-input-field {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: 'Vazirmatn', sans-serif;
      font-size: 14px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }
    
    .tag-input-field:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .tags-display {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      min-height: 20px;
    }
    
    .tag-item {
      background: linear-gradient(135deg, #3b82f6 0%, #1e3a8a 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 13px;
      font-weight: 600;
      font-family: 'Vazirmatn', sans-serif;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: tagSlideIn 0.3s ease;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .tag-remove {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.2s ease;
      margin-right: 4px;
    }
    
    .tag-remove:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: scale(1.1);
    }
    
    @keyframes tagSlideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Checkbox Styles */
    .checkbox-container {
      margin-top: 10px;
    }
    
    .checkbox-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: background-color 0.2s ease;
    }
    
    .checkbox-item:hover {
      background-color: #f1f5f9;
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #3b82f6;
    }
    
    .checkbox-text {
      font-family: 'Vazirmatn', sans-serif;
      font-size: 14px;
      color: #1e293b;
    }

    /* Priority Select Styles */
    .priority-select-container {
      margin-top: 10px;
    }
    
    .priority-select-wrapper {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      background: #f8fafc;
    }
    
    .selected-priorities {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
      min-height: 20px;
    }
    
    .priority-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px;
    }
    
    .priority-option {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
      text-align: center;
      font-family: 'Vazirmatn', sans-serif;
      font-size: 13px;
      transition: all 0.2s ease;
    }
    
    .priority-option:hover {
      border-color: #3b82f6;
      background: #f0f9ff;
    }
    
    .priority-option.selected {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    /* Priority Drag and Drop Styles */
    .priority-drag-container {
      margin-top: 10px;
    }
    
    .priority-drag-wrapper {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      background: #f8fafc;
    }
    
    .priority-drag-list {
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      padding: 15px;
      min-height: 60px;
      background: white;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .priority-drag-list.empty {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #94a3b8;
      font-style: italic;
    }
    
    .priority-drag-item {
      background: linear-gradient(135deg, #3b82f6 0%, #1e3a8a 100%);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: move;
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .priority-drag-item .drag-handle {
      margin-left: 8px;
      cursor: grab;
      font-size: 16px;
    }
    
    .priority-drag-item .remove-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.2s ease;
    }
    
    .priority-drag-item .remove-btn:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: scale(1.1);
    }
    
    .available-options-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px;
    }
    
    .available-option {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
      text-align: center;
      font-family: 'Vazirmatn', sans-serif;
      font-size: 13px;
      transition: all 0.2s ease;
    }
    
    .available-option:hover {
      border-color: #3b82f6;
      background: #f0f9ff;
    }
    
    .available-option.selected {
      background: #e2e8f0;
      color: #94a3b8;
      cursor: not-allowed;
      text-decoration: line-through;
    }
    /* Questions */
    .section {
      border: 1px solid #cbd5e1;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      background: #fff;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      position: relative;
    }
    .section:hover {
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }
    .section strong {
      display: block;
      margin-bottom: 15px;
      color: #1e3a8a;
      font-weight: 600;
      font-size: 16px;
      line-height: 1.6;
      border-right: 4px solid #3b82f6;
      padding-right: 12px;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 12px 15px;
      border-radius: 8px;
      margin: -20px -20px 15px -20px;
    }
    textarea {
      width: 100%;
      height: 100px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 8px;
      resize: vertical;
      font-size: 14px;
      outline: none;
      background: #f9fafb;
      transition: border 0.2s;
    }
    textarea:focus {
      border-color: #3b82f6;
      background: #fff;
    }
    /* Priorities */
    #priority-list {
      margin-top: 10px;
    }
    .priority-item {
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      background-color: #fff;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .priority-number {
      font-weight: bold;
      color: #3b82f6;
    }
    /* Save button */
    .save-button {
      background: #2563eb;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background 0.2s ease;
      display: block;
      margin-top: 20px;
    }
    .save-button:hover {
      background: #1e40af;
    }
  </style>
</head>
<body>

<!-- Ù‡Ø¯Ø± ØµÙØ­Ù‡ -->
<header class="header">
  <div class="header-content">
    <h1 class="header-title">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ø±Ù†Ø¯</h1>
    <nav class="header-nav">
      <a href="dashboard.html" class="nav-link nav-dashboard">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
      <a href="brands.html" class="nav-link nav-brands">Ù„ÛŒØ³Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§</a>
    </nav>
  </div>
</header>

<h2>ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ø±Ù†Ø¯</h2>

<div class="form-row">
  <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØµÙ†Ø¹Øª:</label>
  <div class="dropdown" id="industry-dropdown">
    <div class="dropdown-toggle" onclick="toggleMenu('industry')">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
    <div class="dropdown-menu" id="industry-menu">
      <!-- Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ø³Ø±ÙˆØ± Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
    </div>
  </div>
</div>

<div class="form-row">
  <label>ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†:</label>
  <div class="dropdown" id="employeeCount-dropdown">
    <div class="dropdown-toggle" onclick="toggleMenu('employeeCount')">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
    <div class="dropdown-menu" id="employeeCount-menu">
      <div onclick="selectOption('employeeCount', '1-9')">Û±-Û¹ Ú©Ø§Ø±Ù…Ù†Ø¯</div>
      <div onclick="selectOption('employeeCount', '10-49')">Û±Û°-Û´Û¹ Ú©Ø§Ø±Ù…Ù†Ø¯</div>
      <div onclick="selectOption('employeeCount', '50-99')">ÛµÛ°-Û¹Û¹ Ú©Ø§Ø±Ù…Ù†Ø¯</div>
      <div onclick="selectOption('employeeCount', '100-499')">Û±Û°Û°-Û´Û¹Û¹ Ú©Ø§Ø±Ù…Ù†Ø¯</div>
      <div onclick="selectOption('employeeCount', '500+')">ÛµÛ°Û° Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¨Ù‡ Ø¨Ø§Ù„Ø§</div>
    </div>
  </div>
</div>

<div class="form-row">
  <label>Ø¢Ø®Ø±ÛŒÙ† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù†:</label>
  <div class="dropdown" id="mentalHealthAssessment-dropdown">
    <div class="dropdown-toggle" onclick="toggleMenu('mentalHealthAssessment')">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
    <div class="dropdown-menu" id="mentalHealthAssessment-menu">
      <div onclick="selectOption('mentalHealthAssessment', 'Ú©Ù…ØªØ± Ø§Ø² Û¶ Ù…Ø§Ù‡ Ù¾ÛŒØ´')">Ú©Ù…ØªØ± Ø§Ø² Û¶ Ù…Ø§Ù‡ Ù¾ÛŒØ´</div>
      <div onclick="selectOption('mentalHealthAssessment', 'Û¶â€“Û±Û² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡')">Û¶â€“Û±Û² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</div>
      <div onclick="selectOption('mentalHealthAssessment', 'Û±â€“Û² Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡')">Û±â€“Û² Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡</div>
      <div onclick="selectOption('mentalHealthAssessment', 'Ø¨ÛŒØ´ Ø§Ø² Û² Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡')">Ø¨ÛŒØ´ Ø§Ø² Û² Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡</div>
      <div onclick="selectOption('mentalHealthAssessment', 'Ù‡Ø±Ú¯Ø²')">Ù‡Ø±Ú¯Ø²</div>
    </div>
  </div>
</div>

<div class="form-row">
  <label>Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù…ÙˆØ²Ø´ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ:</label>
  <div class="dropdown" id="organizationalTraining-dropdown">
    <div class="dropdown-toggle" onclick="toggleMenu('organizationalTraining')">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
    <div class="dropdown-menu" id="organizationalTraining-menu">
      <div onclick="selectOption('organizationalTraining', 'Ú©Ù…ØªØ± Ø§Ø² Û³ Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡')">Ú©Ù…ØªØ± Ø§Ø² Û³ Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</div>
      <div onclick="selectOption('organizationalTraining', 'Û³â€“Û±Û² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡')">Û³â€“Û±Û² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</div>
      <div onclick="selectOption('organizationalTraining', 'Ø¨ÛŒØ´ Ø§Ø² Û± Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡')">Ø¨ÛŒØ´ Ø§Ø² Û± Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡</div>
      <div onclick="selectOption('organizationalTraining', 'Ù‡Ø±Ú¯Ø²')">Ù‡Ø±Ú¯Ø²</div>
    </div>
  </div>
</div>

<div style="margin: 30px 0;">
  <h2 style="color: #1e3a8a; border-bottom: 3px solid #3b82f6; padding-bottom: 10px; margin-bottom: 25px;">
    ğŸ“‹ Ø³Ø¤Ø§Ù„Ø§Øª Ø§ØµÙ„ÛŒ
  </h2>
  <div id="essentials-questions"></div>
</div>

<div style="margin: 30px 0;">
  <h2 style="color: #1e3a8a; border-bottom: 3px solid #10b981; padding-bottom: 10px; margin-bottom: 25px;">
    ğŸ” Ø³Ø¤Ø§Ù„Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ
  </h2>
  <div id="extra-questions"></div>
</div>

<div style="margin: 30px 0;">
  <h2 style="color: #1e3a8a; border-bottom: 3px solid #f59e0b; padding-bottom: 10px; margin-bottom: 25px;">
    ğŸ¯ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø¯
  </h2>
  <div id="priority-list"></div>
</div>

<button class="save-button" onclick="saveChanges()">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>

<script>
// ==== Ø³ÙˆØ§Ù„Ø§Øª Ø§ØµÙ„ÛŒ ====
const essentialsQuestions = [
  {id: 1,  q: "ØªØ¹Ø±ÛŒÙ Ø®Ø¯Ù…Ø§Øª Ùˆ Ø¨Ø±Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± ÛŒÚ© Ø¬Ù…Ù„Ù‡"},
  {id: 2,  q: "Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ú©Ù†ÙˆÙ†ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†/Ø¨Ø±Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø±Ø§ Ú†Ú¯ÙˆÙ†Ù‡ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸ"},
  {id: 3,  q: "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ú©Ø³Ø¨ Ùˆ Ú©Ø§Ø± Ø´Ù…Ø§ Ø¯Ø± Ú†Ù‡ ÙØ§Ø²ÛŒ Ø§Ø³ØªØŸ", type: "dropdown", options: ["Ø´Ø±ÙˆØ¹", "ØªØ«Ø¨ÛŒØª", "Ø±Ø´Ø¯ Ø³Ø±ÛŒØ¹", "Ø¨Ù„ÙˆØº", "Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ"]},
  {id: 4,  q: "Û³ Ø§ÙˆÙ„ÙˆÛŒØª Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø¯ØªØ§Ù† Ø¯Ø± Û±Û² Ù…Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ Ú†ÛŒØ³ØªØŸ"},
  {id: 5,  q: "Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ø®Ø¯Ù…Ø§Øª Ø§ØµÙ„ÛŒ Ø³Ø§Ø²Ù…Ø§Ù† Ø´Ù…Ø§ Ú†ÛŒ Ù‡Ø³ØªÙ†Ø¯ØŸ", type: "tag-input"},
  {id: 6,  q: "Ù…Ø¯Ù„ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª/Ø®Ø¯Ù…Ø§Øª Ø´Ù…Ø§ Ú†ÛŒØ³ØªØŸ"},
  {id: 7,  q: "Ø¨ÛŒØ´ØªØ± Ù…Ø´ØªØ±ÛŒØ§Ù† Ø´Ù…Ø§ Ø§Ø² Ú†Ù‡ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒÛŒ Ø¬Ø°Ø¨ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø¯Ø§Ù… Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ ÙØ±ÙˆØ´ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ØŸ"},
  {id: 8,  q: "Ø¨Ù‡ Ù†Ø¸Ø± Ø´Ù…Ø§ Ú©Ø¯Ø§Ù… Ù…Ø­ØµÙˆÙ„/Ø®Ø¯Ù…ØªÙ Ø¨Ø±Ù†Ø¯ØªØ§Ù†ØŒ Ø¸Ø±ÙÛŒØª Ù‡Ù…â€ŒØ§ÙØ²Ø§ÛŒÛŒ Ùˆ ØªØ±Ú©ÛŒØ¨ Ø¨Ø§ Ø³Ø§ÛŒØ± Ø¨Ø±Ù†Ø¯Ù‡Ø§ Ø±Ø§ Ø¯Ø§Ø±Ø¯ØŸ", type: "checkbox"},
  {id: 9,  q: "Ú©Ø¯Ø§Ù… Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø®Ø¯Ù…Øª Ø´Ù…Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø¹Ù†ÙˆØ§Ù† Ù‡Ø¯ÛŒÙ‡ Ø±Ø§ Ø¯Ø§Ø±Ø¯ØŸ", type: "checkbox"},
  {id: 10, q: "Ø³Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ø±Ø¬Ø³ØªÙ‡ Ø¯Ø± Ø±ÙØªØ§Ø± Ùˆ Ø±ÙˆØ­ÛŒÙ‡ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø´Ù…Ø§ Ú©Ø¯Ø§Ù…â€ŒØ§Ù†Ø¯ØŸ"},
  {id: 11, q: "Ù…Ø´ØªØ±ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ø´Ù…Ø§ Ú©Ø¯Ø§Ù… ØµÙ†Ø¹Øª Ø§Ø³ØªØŸ"},
  {id: 12, q: "Ú©Ø¯Ø§Ù… Ù…Ù†Ø§Ø³Ø¨Øªâ€ŒÙ‡Ø§ Ø¯Ø± ØµÙ†Ø¹Øª Ø´Ù…Ø§ØŒ Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù† Ùˆ Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø¯ØªØ§Ù† Ø§Ø² Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø§Ù‡Ù…ÛŒØª Ø¨Ø±Ø®ÙˆØ±Ø¯Ø§Ø± Ø§Ø³ØªØŸ"},
  {id: 13, q: "Ø¯Ø± Ø´Ø±Ø§ÛŒØ· Ú©Ù†ÙˆÙ†ÛŒ (Ø¨Ø§ ÙØ±Ø¶ Ø¯Ø³ØªÛŒØ§Ø¨ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ùˆ Ø­Ø¶ÙˆØ± Ú©Ø§Ù…Ù„ Ù…Ø®Ø§Ø·Ø¨Ø§Ù† Ù‡Ø¯Ù) Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø³Ù¾Ø§Ù†Ø³Ø±ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø´Ù…Ø§ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯ØŸ", type: "checkbox", options: ["Ù…Ø§Ù„ÛŒ", "Ø±Ø³Ø§Ù†Ù‡â€ŒØ§ÛŒ", "Ù…Ú©Ø§Ù† (Ø³Ø§Ù„Ù†ØŒ Ú¯Ø§Ù„Ø±ÛŒØŒ Ø³ÙˆÙ„Ù‡ØŒ ÙØ¶Ø§ÛŒ Ú©Ø§Ø± ÛŒØ§...)", "Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù‡Ø¯ÛŒÙ‡", "Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø®Ø§Øµ"]},
  {id: 14, q: "Ù„Ø·ÙØ§Ù‹ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø¯ØªØ§Ù† (Ø¨Ø³ØªÙ‡ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ· ÙØ¹Ù„ÛŒ) Ø±Ø§ Ù…Ù†Ø¸Ù… ÙØ±Ù…Ø§ÛŒÛŒØ¯", type: "priority-select", options: ["ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ø¨Ø§Ø²Ø§Ø±", "Ø¬Ø°Ø¨ Ø³Ø±Ù…Ø§ÛŒÙ‡", "Ø¨Ù‡Ø¨ÙˆØ¯ Ø®Ø¯Ù…Ø§Øª Ù…Ø´ØªØ±ÛŒ", "ØªÙˆØ³Ø¹Ù‡ Ù…Ø­ØµÙˆÙ„", "Ø§ÙØ²Ø§ÛŒØ´ ÙØ±ÙˆØ´", "ØªÙˆØ³Ø¹Ù‡ ØªÛŒÙ…", "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø± Ø¬Ø¯ÛŒØ¯", "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø± Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„", "ØªØ¨Ù„ÛŒØºØ§Øª Ùˆ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ", "Ø§Ø±ØªÙ‚Ø§Ø¡ ÙÙ†Ø§ÙˆØ±ÛŒ"]},
  {id: 15, q: "Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø± Ú†Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ù¾Ø±Ø³Ù†Ù„â€ŒØªØ§Ù† Ø±Ø§ Ø§Ø² Ù†Ø¸Ø± Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø¯ÛŒØ¯ØŸ", type: "dropdown", options: ["Ú©Ù…ØªØ± Ø§Ø² Û¶ Ù…Ø§Ù‡ Ù¾ÛŒØ´", "Û¶â€“Û±Û² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡", "Û±â€“Û² Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡", "Ø¨ÛŒØ´ Ø§Ø² Û² Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡", "Ù‡Ø±Ú¯Ø²"]},
  {id: 16, q: "Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø±ÛŒ Ú©Ù‡ Ø¨Ø±Ù†Ø¯ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ ØªÙˆØ§Ù†Ù…Ù†Ø¯Ø³Ø§Ø²ÛŒ Ú©Ø§Ø±Ú©Ù†Ø§Ù†ØŒ Ø§Ø² Ù…Ø¯Ø±Ø³ ÛŒØ§ ÛŒÚ© Ù…Ø´Ø§ÙˆØ± Ø¯Ø¹ÙˆØª Ùˆ ÛŒÚ© Ø¯ÙˆØ±Ù‡ ÛŒØ§ Ú©Ø§Ø±Ú¯Ø§Ù‡ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ Ø¨Ø±Ú¯Ø²Ø§Ø± Ú©Ø±Ø¯ØŒ Ú†Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø¨ÙˆØ¯Ù‡ØŸ", type: "dropdown", options: ["Ú©Ù…ØªØ± Ø§Ø² Û³ Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡", "Û³â€“Û±Û² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡", "Ø¨ÛŒØ´ Ø§Ø² Û± Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡", "Ù‡Ø±Ú¯Ø²"]}
];
const extraQuestions = [
  {id: 17, q: "Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ø´Ù…Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ Ø¯Ø± Ø§Ø¨Ø¹Ø§Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø±Ø§ Ø¯Ø§Ø±Ø¯ØŸ"},
  {id: 18, q: "Ú†Ù‡ Ø¸Ø±ÙÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø± Ø³Ø§Ø²Ù…Ø§Ù† Ø´Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø¨ØªÙˆØ§Ù† Ø§Ø² Ø¢Ù†â€ŒÙ‡Ø§ Ø¯Ø± Ú†Ø§Ø±Ú†ÙˆØ¨ Ù‡Ù…Ú©Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±Ú© Ø¨Ù‡Ø±Ù‡â€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ Ú©Ø±Ø¯ØŸ", type: "tag-input"},
  {id: 19, q: "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ Ø´Ù…Ø§ Ú©Ù…ØªØ± Ø§Ø² Ø¸Ø±ÙÛŒØª ÙˆØ§Ù‚Ø¹ÛŒ Ø®ÙˆØ¯ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ØŸ", type: "checkbox"},
  {id: 20, q: "Ø¨Ø§ Ú©Ø¯Ø§Ù… Ø¨Ø±Ù†Ø¯Ù‡Ø§ ØªØ§Ú©Ù†ÙˆÙ† ØªØ¬Ø±Ø¨Ù‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¯Ø§Ø´ØªÙ‡â€ŒØ§ÛŒØ¯ØŸ", type: "tag-input"},
  {id: 21, q: "Ø®Ø· Ù‚Ø±Ù…Ø²Ù‡Ø§ Ùˆ Ø¹ÙˆØ§Ù…Ù„ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù…ÙˆØ¬Ø¨ ØªÙˆÙ‚Ù ÛŒÚ© Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø§Ø² Ø³ÙˆÛŒ Ø´Ù…Ø§ Ø´ÙˆÙ†Ø¯ØŒ Ú†Ù‡ Ù…ÙˆØ§Ø±Ø¯ÛŒ Ù‡Ø³ØªÙ†Ø¯ØŸ"},
  {id: 22, q: "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´ Ø§Ø² ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒØªØ§Ù† Ø²Ù…Ø§Ù† ÛŒØ§ Ø§Ù†Ø±Ú˜ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ Ùˆ Ú†Ø±Ø§ØŸ"},
  {id: 23, q: "Ø¨Ø±Ø§ÛŒ Ø±Ø´Ø¯ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØªØ§Ù† Ø¯Ø± ÛŒÚ© Ø³Ø§Ù„ Ø¢ÛŒÙ†Ø¯Ù‡ØŒ Ú†Ù‡ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ ÛŒØ§ Ù…Ù†Ø§Ø¨Ø¹ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø§Ù„Ø§Ù† Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ"},
  {id: 24, q: "Ø§Ø®ÛŒØ±Ø§Ù‹ Ú†Ù‡ ÙØ±ØµØª Ù…Ù‡Ù…ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ú©Ù‡ Ø­Ø³ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ù†Ø¯Ø§Ø´ØªÙ† Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¢Ù† Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ"},
  {id: 25, q: "Ø±Ù‚Ø¨Ø§ÛŒ Ø´Ù…Ø§ Ø¯Ø± Ú†Ù‡ Ø²Ù…ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡â€ŒØ§Ù†Ø¯ ÛŒØ§ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ú©Ù‡ Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø´Ø±ÙˆØ¹ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ"},
  {id: 26, q: "Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù…Ø´ØªØ±ÛŒØ§Ù† Ú†Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø­ØµÙˆÙ„Ø§Øª ÛŒØ§ Ø®Ø¯Ù…Ø§Øª Ø´Ù…Ø§ Ø¯Ø§Ø±Ù†Ø¯ØŸ"}
];
const allQuestions = [...essentialsQuestions, ...extraQuestions];

// ==== Ø³Ø§Ø®Øª Ø³ÙˆØ§Ù„Ø§Øª ====
function buildQuestions(containerId, questionsArr) {
  const parent = document.getElementById(containerId);
  
  // Ù…Ø±ØªØ¨ Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù…Ø§Ø±Ù‡
  const sortedQuestions = questionsArr.sort((a, b) => a.id - b.id);
  
  sortedQuestions.forEach(({id, q, type, options, loadFromQuestion}) => {
    const wrap = document.createElement('div');
    wrap.className = 'section';
    wrap.innerHTML = `<strong>${id}. ${q}</strong>`;
    
    if (type === 'dropdown' && options) {
      // Ø§ÛŒØ¬Ø§Ø¯ dropdown Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 3
      const dropdownDiv = document.createElement('div');
      dropdownDiv.className = 'dropdown';
      dropdownDiv.innerHTML = `
        <div class="dropdown-toggle" onclick="toggleMenu('question-${id}')" id="question-${id}-toggle">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â–¼</div>
        <div class="dropdown-menu" id="question-${id}-menu">
          ${options.map(option => `<div onclick="selectQuestionOption('${id}', \`${option.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)">${option}</div>`).join('')}
        </div>
      `;
      wrap.appendChild(dropdownDiv);
    } else if (type === 'tag-input') {
      // Ø§ÛŒØ¬Ø§Ø¯ tag input
      const tagContainer = document.createElement('div');
      tagContainer.className = 'tag-input-container';
      
      // Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ Ù„ÙˆØ¯ Ø´ÙˆØ¯
      if (loadFromQuestion) {
        tagContainer.innerHTML = `
          <div class="tag-input-wrapper">
            <input type="text" id="tag-input-${id}" placeholder="Ù…ØªÙ† Ø§Ø¶Ø§ÙÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Enter Ø¨Ø²Ù†ÛŒØ¯..." class="tag-input-field">
            <div class="tags-display" id="tags-${id}"></div>
            <div class="load-from-question-info" style="margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 8px; border: 1px solid #e0e7ff;">
              <small style="color: #1e40af; font-weight: 600;">ğŸ“‹ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø³ÙˆØ§Ù„ ${loadFromQuestion} Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</small>
            </div>
          </div>
        `;
      } else {
        tagContainer.innerHTML = `
          <div class="tag-input-wrapper">
            <input type="text" id="tag-input-${id}" placeholder="Ù…ØªÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Enter Ø¨Ø²Ù†ÛŒØ¯..." class="tag-input-field">
            <div class="tags-display" id="tags-${id}"></div>
          </div>
        `;
      }
      
      wrap.appendChild(tagContainer);
      
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Enter key
      const input = tagContainer.querySelector(`#tag-input-${id}`);
      input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          addTag(id, this.value.trim());
          this.value = '';
        }
      });
      
      // Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ Ù„ÙˆØ¯ Ø´ÙˆØ¯ØŒ ØªÚ¯â€ŒÙ‡Ø§ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†
      if (loadFromQuestion) {
        setTimeout(() => {
          loadTagsFromQuestion(id, loadFromQuestion);
        }, 100);
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø³ÙˆØ§Ù„ Ù…Ù†Ø¨Ø¹
        const sourceInput = document.getElementById(`tag-input-${loadFromQuestion}`);
        if (sourceInput) {
          sourceInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              // Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† ØªÚ¯ Ø¬Ø¯ÛŒØ¯ØŒ Ø³ÙˆØ§Ù„ Ù‡Ø¯Ù Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†
              setTimeout(() => {
                loadTagsFromQuestion(id, loadFromQuestion);
              }, 200);
            }
          });
        }
      }
    } else if (type === 'checkbox' && options) {
      // Ø§ÛŒØ¬Ø§Ø¯ checkbox Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 27
      const checkboxContainer = document.createElement('div');
      checkboxContainer.className = 'checkbox-container';
      checkboxContainer.innerHTML = `
        <div class="checkbox-options" id="checkbox-options-${id}">
          ${options.map(option => `
            <label class="checkbox-item">
              <input type="checkbox" name="question-${id}" value="${option.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}">
              <span class="checkbox-text">${option.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>
            </label>
          `).join('')}
        </div>
      `;
      wrap.appendChild(checkboxContainer);
    } else if (type === 'checkbox' && (id === 8 || id === 9)) {
      // Ø§ÛŒØ¬Ø§Ø¯ checkbox Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 8 Ùˆ 9 Ú©Ù‡ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒØ´ Ø§Ø² Ø³ÙˆØ§Ù„ 5 Ù…ÛŒâ€ŒØ¢ÛŒØ¯
      const checkboxContainer = document.createElement('div');
      checkboxContainer.className = 'checkbox-container';
      checkboxContainer.innerHTML = `
        <div class="checkbox-options" id="checkbox-options-${id}">
          <div class="no-options-message" style="color: #666; font-style: italic; padding: 10px;">
            Ø§Ø¨ØªØ¯Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø³ÙˆØ§Ù„ 5 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
          </div>
        </div>
      `;
      wrap.appendChild(checkboxContainer);
    } else if (type === 'checkbox' && id === 19) {
      // Ø§ÛŒØ¬Ø§Ø¯ checkbox Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 19 Ú©Ù‡ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒØ´ Ø§Ø² Ø³ÙˆØ§Ù„ 18 Ù…ÛŒâ€ŒØ¢ÛŒØ¯
      const checkboxContainer = document.createElement('div');
      checkboxContainer.className = 'checkbox-container';
      checkboxContainer.innerHTML = `
        <div class="checkbox-options" id="checkbox-options-${id}">
          <div class="no-options-message" style="color: #666; font-style: italic; padding: 10px;">
            Ø§Ø¨ØªØ¯Ø§ Ø¸Ø±ÙÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø³ÙˆØ§Ù„ 18 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
          </div>
        </div>
      `;
      wrap.appendChild(checkboxContainer);
    } else if (type === 'priority-select' && options) {
      // Ø§ÛŒØ¬Ø§Ø¯ priority select Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 14
      const priorityContainer = document.createElement('div');
      priorityContainer.className = 'priority-select-container';
      priorityContainer.innerHTML = `
        <div class="priority-select-wrapper">
          <div class="selected-priorities" id="selected-priorities-${id}"></div>
          <div class="priority-options">
            ${options.map(option => `
              <div class="priority-option" onclick="selectPriority('${id}', \`${option.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)">${option}</div>
            `).join('')}
          </div>
        </div>
      `;
      wrap.appendChild(priorityContainer);
    } else {
      // Ø§ÛŒØ¬Ø§Ø¯ textarea Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ø¹Ø§Ø¯ÛŒ
      const txt = document.createElement('textarea');
      txt.id = `answer-${id}`;
      wrap.appendChild(txt);
    }
    
    parent.appendChild(wrap);
  });
}

// ==== Dropdown ====
function toggleMenu(type) {
  const menu = document.getElementById(`${type}-menu`);
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function selectOption(type, val) {
  document.querySelector(`#${type}-dropdown .dropdown-toggle`).innerText = val;
  document.getElementById(`${type}-menu`).style.display = 'none';
}

function selectQuestionOption(questionId, val) {
  document.getElementById(`question-${questionId}-toggle`).innerText = val;
  document.getElementById(`question-${questionId}-menu`).style.display = 'none';
}

// Ø¨Ø³ØªÙ† dropdown Ù‡Ø§ Ù‡Ù†Ú¯Ø§Ù… Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬
document.addEventListener('click', e => {
  // Ø¨Ø³ØªÙ† dropdown Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
  ['industry', 'employeeCount'].forEach(type => {
    const toggle = document.querySelector(`#${type}-dropdown .dropdown-toggle`);
    const menu = document.getElementById(`${type}-menu`);
    if (!toggle.contains(e.target) && !menu.contains(e.target)) menu.style.display = 'none';
  });
  
  // Ø¨Ø³ØªÙ† dropdown Ù‡Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª
  document.querySelectorAll('[id^="question-"][id$="-menu"]').forEach(menu => {
    const questionId = menu.id.replace('-menu', '');
    const toggle = document.getElementById(`${questionId}-toggle`);
    if (!toggle.contains(e.target) && !menu.contains(e.target)) {
      menu.style.display = 'none';
    }
  });
});

/********************  Tag Functions  ********************/
// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÚ¯ Ø¬Ø¯ÛŒØ¯
function addTag(questionId, tagText) {
  if (!tagText) return;
  
  const tagsContainer = document.getElementById(`tags-${questionId}`);
  if (!tagsContainer) return;
  
  // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† ØªÚ¯
  const existingTags = Array.from(tagsContainer.querySelectorAll('.tag-item')).map(tag => 
    tag.querySelector('.tag-text').textContent
  );
  
  if (existingTags.includes(tagText)) {
    alert('Ø§ÛŒÙ† ØªÚ¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª!');
    return;
  }
  
  addTagToContainer(questionId, tagText, false);
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 8 Ùˆ 9 Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ 5 Ø§Ø³Øª
  if (questionId === 5) {
    updateQuestion8Options();
  }
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 19 Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ 18 Ø§Ø³Øª
  if (questionId === 18) {
    updateQuestion19Options();
  }
}

// Ø­Ø°Ù ØªÚ¯
function removeTag(questionId, tagText) {
  const tagsContainer = document.getElementById(`tags-${questionId}`);
  if (!tagsContainer) return;
  
  const tagElements = tagsContainer.querySelectorAll('.tag-item');
  tagElements.forEach(tag => {
    if (tag.querySelector('.tag-text').textContent === tagText) {
      tag.remove();
    }
  });
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 8 Ùˆ 9 Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ 5 Ø§Ø³Øª
  if (questionId === 5) {
    updateQuestion8Options();
  }
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 19 Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ 18 Ø§Ø³Øª
  if (questionId === 18) {
    updateQuestion19Options();
  }
}

// Ø¯Ø±ÛŒØ§ÙØª ØªÚ¯â€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ø³ÙˆØ§Ù„
function getTagsForQuestion(questionId) {
  const tagsContainer = document.getElementById(`tags-${questionId}`);
  if (!tagsContainer) return [];
  
  return Array.from(tagsContainer.querySelectorAll('.tag-item')).map(tag => 
    tag.querySelector('.tag-text').textContent
  );
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÚ¯â€ŒÙ‡Ø§ Ø§Ø² Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ
function loadTagsFromQuestion(targetQuestionId, sourceQuestionId) {
  const sourceTags = getTagsForQuestion(sourceQuestionId);
  const targetContainer = document.getElementById(`tags-${targetQuestionId}`);
  
  if (!targetContainer || sourceTags.length === 0) return;
  
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³ÙˆØ§Ù„ Ù‡Ø¯Ù
  targetContainer.innerHTML = '';
  
  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ Ù…Ù†Ø¨Ø¹
  sourceTags.forEach(tagText => {
    addTagToContainer(targetQuestionId, tagText, true); // true = Ø§Ø² Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø± Ù„ÙˆØ¯ Ø´Ø¯Ù‡
  });
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÚ¯ Ø¨Ù‡ container Ø¨Ø¯ÙˆÙ† Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ (Ø¨Ø±Ø§ÛŒ Ù„ÙˆØ¯ Ø§Ø² Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±)
function addTagToContainer(questionId, tagText, isFromOtherQuestion = false) {
  const tagsContainer = document.getElementById(`tags-${questionId}`);
  if (!tagsContainer) return;
  
  const tagItem = document.createElement('div');
  tagItem.className = 'tag-item';
  tagItem.style.cssText = `
    background: ${isFromOtherQuestion ? '#e0f2fe' : '#3b82f6'};
    color: ${isFromOtherQuestion ? '#0369a1' : 'white'};
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin: 2px;
    border: 1px solid ${isFromOtherQuestion ? '#bae6fd' : '#3b82f6'};
  `;
  
  tagItem.innerHTML = `
    <span class="tag-text">${tagText}</span>
    ${!isFromOtherQuestion ? `<span class="tag-remove" onclick="removeTag(${questionId}, this)" style="cursor: pointer; font-weight: bold; margin-right: 4px;">Ã—</span>` : ''}
  `;
  
  tagsContainer.appendChild(tagItem);
}

// Ø§Ù†ØªØ®Ø§Ø¨ Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 28
function selectPriority(questionId, priority) {
  const selectedContainer = document.getElementById(`selected-priorities-${questionId}`);
  
  // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø³ØªÛŒ
  const allOptions = document.querySelectorAll(`.priority-options .priority-option`);
  let option = null;
  allOptions.forEach(opt => {
    const onclickAttr = opt.getAttribute('onclick');
    if (onclickAttr && onclickAttr.includes(`selectPriority('${questionId}'`)) {
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ØªÙ† priority Ø§Ø² onclick attribute
      const match = onclickAttr.match(/selectPriority\('[^']+',\s*`([^`]+)`\)/);
      if (match && match[1] === priority) {
        option = opt;
      }
    }
  });
  
  if (!selectedContainer || !option) return;
  
  // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡
  const isSelected = option.classList.contains('selected');
  
  if (isSelected) {
    // Ø­Ø°Ù Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§
    option.classList.remove('selected');
    const selectedItem = selectedContainer.querySelector(`[data-priority="${priority}"]`);
    if (selectedItem) selectedItem.remove();
  } else {
    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ (Ø­Ø¯Ø§Ú©Ø«Ø± 3)
    const selectedCount = selectedContainer.children.length;
    if (selectedCount >= 3) {
      alert('Ø­Ø¯Ø§Ú©Ø«Ø± 3 Ø§ÙˆÙ„ÙˆÛŒØª Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!');
      return;
    }
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§
    option.classList.add('selected');
    const selectedItem = document.createElement('div');
    selectedItem.className = 'tag-item';
    selectedItem.setAttribute('data-priority', priority);
    selectedItem.innerHTML = `
      <span class="tag-text">${priority}</span>
      <button class="tag-remove" onclick="removePriority('${questionId}', \`${priority.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)">Ã—</button>
    `;
    selectedContainer.appendChild(selectedItem);
  }
}

// Ø­Ø°Ù Ø§ÙˆÙ„ÙˆÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
function removePriority(questionId, priority) {
  const selectedContainer = document.getElementById(`selected-priorities-${questionId}`);
  
  // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø³ØªÛŒ
  const allOptions = document.querySelectorAll(`.priority-options .priority-option`);
  let option = null;
  allOptions.forEach(opt => {
    const onclickAttr = opt.getAttribute('onclick');
    if (onclickAttr && onclickAttr.includes(`selectPriority('${questionId}'`)) {
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ØªÙ† priority Ø§Ø² onclick attribute
      const match = onclickAttr.match(/selectPriority\('[^']+',\s*`([^`]+)`\)/);
      if (match && match[1] === priority) {
        option = opt;
      }
    }
  });
  
  if (selectedContainer && option) {
    option.classList.remove('selected');
    const selectedItem = selectedContainer.querySelector(`[data-priority="${priority}"]`);
    if (selectedItem) selectedItem.remove();
  }
}

// Ø¯Ø±ÛŒØ§ÙØª Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
function getSelectedPriorities(questionId) {
  const selectedContainer = document.getElementById(`selected-priorities-${questionId}`);
  if (!selectedContainer) return [];
  
  return Array.from(selectedContainer.children).map(item => 
    item.querySelector('.tag-text').textContent
  );
}

// Ø¯Ø±ÛŒØ§ÙØª checkbox Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
function getSelectedCheckboxes(questionId) {
  const checkboxes = document.querySelectorAll(`input[name="question-${questionId}"]:checked`);
  return Array.from(checkboxes).map(cb => cb.value);
}

// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ 8 Ùˆ 9 Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ 5
function updateQuestion8Options() {
  const tagsFromQ5 = getTagsForQuestion(5);
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 8
  const q8Container = document.getElementById('checkbox-options-8');
  if (q8Container) {
    if (tagsFromQ5.length === 0) {
      q8Container.innerHTML = `
        <div class="no-options-message" style="color: #666; font-style: italic; padding: 10px;">
          Ø§Ø¨ØªØ¯Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø³ÙˆØ§Ù„ 5 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
        </div>
      `;
    } else {
      q8Container.innerHTML = tagsFromQ5.map(tag => `
        <label class="checkbox-item">
          <input type="checkbox" name="question-8" value="${tag.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}">
          <span class="checkbox-text">${tag.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>
        </label>
      `).join('');
    }
  }
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 9
  const q9Container = document.getElementById('checkbox-options-9');
  if (q9Container) {
    if (tagsFromQ5.length === 0) {
      q9Container.innerHTML = `
        <div class="no-options-message" style="color: #666; font-style: italic; padding: 10px;">
          Ø§Ø¨ØªØ¯Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø³ÙˆØ§Ù„ 5 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
        </div>
      `;
    } else {
      q9Container.innerHTML = tagsFromQ5.map(tag => `
        <label class="checkbox-item">
          <input type="checkbox" name="question-9" value="${tag.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}">
          <span class="checkbox-text">${tag.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>
        </label>
      `).join('');
    }
  }
}

// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ 19 Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ 18
function updateQuestion19Options() {
  const tagsFromQ18 = getTagsForQuestion(18);
  
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 19
  const q19Container = document.getElementById('checkbox-options-19');
  if (q19Container) {
    if (tagsFromQ18.length === 0) {
      q19Container.innerHTML = `
        <div class="no-options-message" style="color: #666; font-style: italic; padding: 10px;">
          Ø§Ø¨ØªØ¯Ø§ Ø¸Ø±ÙÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø³ÙˆØ§Ù„ 18 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
        </div>
      `;
    } else {
      q19Container.innerHTML = tagsFromQ18.map(tag => `
        <label class="checkbox-item">
          <input type="checkbox" name="question-19" value="${tag.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}">
          <span class="checkbox-text">${tag.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>
        </label>
      `).join('');
    }
  }
}


// ==== Ù„ÙˆØ¯ Ø¨Ø±Ù†Ø¯ ====
let brandId = null;
async function loadBrand() {
  brandId = new URLSearchParams(window.location.search).get('id');
  if (!brandId) return alert('Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø±Ù†Ø¯ ÛŒØ§ÙØª Ù†Ø´Ø¯');
  const res = await fetch(`/api/brand/${brandId}`, {credentials:'include'});
  const brand = await res.json();

  document.querySelector('#industry-dropdown .dropdown-toggle').innerText = brand.field;
  document.querySelector('#employeeCount-dropdown .dropdown-toggle').innerText = brand.employeeCount || 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯';
  
  // Ù„ÙˆØ¯ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
  if (brand.mentalHealthAssessment) {
    document.querySelector('#mentalHealthAssessment-dropdown .dropdown-toggle').innerText = brand.mentalHealthAssessment;
  }
  if (brand.organizationalTraining) {
    document.querySelector('#organizationalTraining-dropdown .dropdown-toggle').innerText = brand.organizationalTraining;
  }

  // Ø§Ø¨ØªØ¯Ø§ Ø³ÙˆØ§Ù„ 5ØŒ 18 Ùˆ 20 Ø±Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
  brand.questions.forEach(({id, answer})=>{
    if (id === 5 || id === 18 || id === 20) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 5ØŒ 18 Ùˆ 20 Ú©Ù‡ tag-input Ù‡Ø³ØªÙ†Ø¯
      if (answer) {
        const tags = answer.split('ØŒ ').filter(tag => tag.trim());
        tags.forEach(tag => addTag(id, tag.trim()));
      }
    }
  });
  
  // Ø³Ù¾Ø³ Ø¨Ù‚ÛŒÙ‡ Ø³ÙˆØ§Ù„Ø§Øª Ø±Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
  brand.questions.forEach(({id, answer})=>{
    if (id === 3 || id === 15 || id === 16) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª dropdown (Ø³ÙˆØ§Ù„Ø§Øª 3ØŒ 15ØŒ 16)
      const toggle = document.getElementById(`question-${id}-toggle`);
      if (toggle) toggle.innerText = answer || 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯';
    } else if (id === 8 || id === 9) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 8 Ùˆ 9 Ú©Ù‡ checkbox Ù‡Ø³ØªÙ†Ø¯ - Ø§Ø¨ØªØ¯Ø§ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      updateQuestion8Options();
      // Ø³Ù¾Ø³ checkbox Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø±Ø§ ØªÛŒÚ© Ù…ÛŒâ€ŒØ²Ù†ÛŒÙ…
      if (answer) {
        const selectedTags = answer.split('ØŒ ').filter(tag => tag.trim());
        selectedTags.forEach(tag => {
          // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² querySelectorAll Ùˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø³ØªÛŒ
          const checkboxes = document.querySelectorAll(`input[name="question-${id}"]`);
          checkboxes.forEach(checkbox => {
            if (checkbox.value === tag.trim()) {
              checkbox.checked = true;
            }
          });
        });
      }
    } else if (id === 19) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 19 Ú©Ù‡ checkbox Ø§Ø³Øª - Ø§Ø¨ØªØ¯Ø§ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      updateQuestion19Options();
      // Ø³Ù¾Ø³ checkbox Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø±Ø§ ØªÛŒÚ© Ù…ÛŒâ€ŒØ²Ù†ÛŒÙ…
      if (answer) {
        const selectedTags = answer.split('ØŒ ').filter(tag => tag.trim());
        selectedTags.forEach(tag => {
          // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² querySelectorAll Ùˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø³ØªÛŒ
          const checkboxes = document.querySelectorAll(`input[name="question-${id}"]`);
          checkboxes.forEach(checkbox => {
            if (checkbox.value === tag.trim()) {
              checkbox.checked = true;
            }
          });
        });
      }
    } else if (id === 13) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 13 Ú©Ù‡ checkbox Ø§Ø³Øª
      if (answer) {
        const selectedOptions = answer.split('ØŒ ').filter(option => option.trim());
        selectedOptions.forEach(option => {
          // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² querySelectorAll Ùˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø³ØªÛŒ
          const checkboxes = document.querySelectorAll('input[name="question-13"]');
          checkboxes.forEach(checkbox => {
            if (checkbox.value === option.trim()) {
              checkbox.checked = true;
            }
          });
        });
      }
    } else if (id === 14) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ 14 Ú©Ù‡ priority-select Ø§Ø³Øª
      if (answer) {
        const selectedPriorities = answer.split('ØŒ ').filter(priority => priority.trim());
        selectedPriorities.forEach(priority => {
          selectPriority(14, priority.trim());
        });
      }
    } else if (id !== 5 && id !== 18 && id !== 20) {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª textarea (Ø¨Ù‡ Ø¬Ø² Ø³ÙˆØ§Ù„Ø§Øª tag-input Ú©Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ù„ÙˆØ¯ Ø´Ø¯Ù‡)
      const el = document.getElementById(`answer-${id}`);
      if (el) el.value = answer;
    }
  });

  // Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§
  const allPriorities = [
    "ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ø¨Ø§Ø²Ø§Ø±",
    "Ø¬Ø°Ø¨ Ø³Ø±Ù…Ø§ÛŒÙ‡", 
    "Ø¨Ù‡Ø¨ÙˆØ¯ Ø®Ø¯Ù…Ø§Øª Ù…Ø´ØªØ±ÛŒ",
    "ØªÙˆØ³Ø¹Ù‡ Ù…Ø­ØµÙˆÙ„",
    "Ø§ÙØ²Ø§ÛŒØ´ ÙØ±ÙˆØ´",
    "ØªÙˆØ³Ø¹Ù‡ ØªÛŒÙ…",
    "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø± Ø¬Ø¯ÛŒØ¯",
    "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø± Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„",
    "ØªØ¨Ù„ÛŒØºØ§Øª Ùˆ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ",
    "Ø§Ø±ØªÙ‚Ø§Ø¡ ÙÙ†Ø§ÙˆØ±ÛŒ"
  ];

  const list = document.getElementById('priority-list');
  list.innerHTML = '';
  
  // Ø§Ú¯Ø± Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡
  if (brand.priorities && brand.priorities.length > 0) {
    // Ù†Ù…Ø§ÛŒØ´ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ ØµØ­ÛŒØ­
    brand.priorities.forEach((priority, i) => {
      const div = document.createElement('div');
      div.className = 'priority-item';
      div.innerHTML = `<span class="priority-text">${priority}</span><span class="priority-number">${i+1}</span>`;
      list.appendChild(div);
    });
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø§Ù‚ÛŒ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
    allPriorities.forEach(priority => {
      if (!brand.priorities.includes(priority)) {
        const div = document.createElement('div');
        div.className = 'priority-item';
        div.innerHTML = `<span class="priority-text">${priority}</span><span class="priority-number">${list.children.length + 1}</span>`;
        list.appendChild(div);
      }
    });
  } else {
    // Ø§Ú¯Ø± Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡ØŒ Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡
    allPriorities.forEach((p,i)=>{
      const div = document.createElement('div');
      div.className = 'priority-item';
      div.innerHTML = `<span class="priority-text">${p}</span><span class="priority-number">${i+1}</span>`;
      list.appendChild(div);
    });
  }
  
  new Sortable(list,{animation:150,onEnd:updatePriorityNumbers});
}
function updatePriorityNumbers(){
  Array.from(document.querySelectorAll('#priority-list .priority-item')).forEach((el,i)=>{
    el.querySelector('.priority-number').textContent = i+1;
  });
}

// ==== Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª ====
async function saveChanges() {
  const industry = document.querySelector('#industry-dropdown .dropdown-toggle').innerText;
  const employeeCount = document.querySelector('#employeeCount-dropdown .dropdown-toggle').innerText;
  const mentalHealthAssessment = document.querySelector('#mentalHealthAssessment-dropdown .dropdown-toggle').innerText;
  const organizationalTraining = document.querySelector('#organizationalTraining-dropdown .dropdown-toggle').innerText;
  
  // Validation
  if (employeeCount === 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯') {
    return alert('Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!');
  }
  
  const questions = allQuestions.map(({id, q, type})=>{
    let answer = '';
    if (type === 'dropdown') {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª dropdown (Ø³ÙˆØ§Ù„Ø§Øª 3ØŒ 25ØŒ 26)
      const toggle = document.getElementById(`question-${id}-toggle`);
      answer = toggle ? toggle.innerText.replace(' â–¼', '') : '';
    } else if (type === 'tag-input') {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª tag-input (Ø³ÙˆØ§Ù„ 6ØŒ 12 Ùˆ 19)
      const tags = getTagsForQuestion(id);
      answer = tags.join('ØŒ ');
    } else if (type === 'checkbox') {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª checkbox (Ø³ÙˆØ§Ù„Ø§Øª 8ØŒ 11ØŒ 13 Ùˆ 27)
      const selected = getSelectedCheckboxes(id);
      answer = selected.join('ØŒ ');
    } else if (type === 'priority-select') {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„ priority-select (Ø³ÙˆØ§Ù„ 28)
      const selected = getSelectedPriorities(id);
      answer = selected.join('ØŒ ');
    } else {
      // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª textarea
      const textarea = document.getElementById(`answer-${id}`);
      answer = textarea ? textarea.value : '';
    }
    return {id, question: q, answer};
  });
  const priorities = Array.from(document.querySelectorAll('#priority-list .priority-item .priority-text')).map(el=>el.innerText);

  const brandData = {
    field: industry, 
    employeeCount, 
    mentalHealthAssessment: mentalHealthAssessment !== 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯' ? mentalHealthAssessment : undefined,
    organizationalTraining: organizationalTraining !== 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯' ? organizationalTraining : undefined,
    questions, 
    priorities
  };

  const res = await fetch(`/api/brand/${brandId}`, {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    credentials:'include',
    body:JSON.stringify(brandData)
  });
  const data = await res.json();
  if(res.ok){ alert('ØªØºÛŒÛŒØ±Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯'); window.location='brands.html'; }
  else alert(data.error||'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡');
}

// ==== Ù„ÙˆØ¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ ====
async function loadCategories() {
  try {
    const res = await fetch('/api/brand-categories', { credentials: 'include' });
    if (!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§');
    const data = await res.json();
    
    const menu = document.getElementById('industry-menu');
    menu.innerHTML = '';
    
    if (data.categories.length === 0) {
      menu.innerHTML = '<div>Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</div>';
    } else {
      data.categories.forEach(category => {
        const div = document.createElement('div');
        div.textContent = category;
        div.onclick = () => selectOption('industry', category);
        menu.appendChild(div);
      });
    }
  } catch (err) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:', err);
    // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    const menu = document.getElementById('industry-menu');
    menu.innerHTML = `
      <div onclick="selectOption('industry', 'ÙÙ†Ø§ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª')">ÙÙ†Ø§ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</div>
      <div onclick="selectOption('industry', 'ØºØ°Ø§ Ùˆ Ø¯Ø§Ø±Ùˆ')">ØºØ°Ø§ Ùˆ Ø¯Ø§Ø±Ùˆ</div>
      <div onclick="selectOption('industry', 'Ø³Ø§Ø®ØªÙ…Ø§Ù†')">Ø³Ø§Ø®ØªÙ…Ø§Ù†</div>
    `;
  }
}

// ==== Ø´Ø±ÙˆØ¹ ====
window.addEventListener('DOMContentLoaded',()=>{
  buildQuestions('essentials-questions',essentialsQuestions);
  buildQuestions('extra-questions',extraQuestions);
  loadCategories();
  loadBrand();
  
  // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„ 8 Ùˆ 19 Ø¨Ø¹Ø¯ Ø§Ø² Ù„ÙˆØ¯ Ú©Ø§Ù…Ù„
  setTimeout(() => {
    updateQuestion8Options();
    updateQuestion19Options();
  }, 100);
});
</script>

</body>
</html>
